
var _VLVisitChecked = false;
var _PageLoadStart = new Date();
var _PageLoadFinish = null;
var _SendPageLoadTime = false;
var _CookieDomain = "vatanbilgisayar.com";
var _VisiLightBoxLoaded	= false;
var _InitVisiLightBoxCalled = false;
var _IsTargetEnabled = true;
var _IsWidgetEnabled = true;

if(_SendPageLoadTime){
	if (!window.attachEvent) {
		window.addEventListener("load", function () {
			_PageLoadFinish = new Date();
		}, false);
	} else {
		window.attachEvent("onload", function () {
			_PageLoadFinish = new Date();
		});
	}
}

function Visilabs(){
  	var	_this = this;
	this.Debug = false;
	this.NReferrer = null;
	this.CookieID = null;
	this.ReferrerURI = null;
	this.NewCookieTimeout = 720;
	this.MaxCookieDuration = 720;
	this.TD = 1036800;
	this.VisitTimeout = 30;
	this.OrganizationID = "6E727947436A5048494D4D3D";
	this.SiteID = "6937556163626B434966303D";
	this.DataSource	= "vatanbilgisayarcom";
	this.SegmentURL	= "lgr.visilabs.net/";
	this.TargetURL = "s.visilabs.net/";
	this.RealtimeURL = "rt.visilabs.net/";
	this.StartupFunctions = [];
	this.CollectFunctions = [];
	this.Parameters = new Object();
	this.URI = parseUri(this.ClearURL(document.location.href.toString()));
	this.RequestProtocol = this.URI.protocol;
	this.IsNew = false;
	this.CookieManager = new VLCookieManager(_this);
	this.DebuggerEnabled = false;
	this.Debugger = null;
	this.UseLocalStorage = false;
	this.DontTrack = "OM.donttrack";
	this.ExternalCookies = new Array({CookieName:"OM_TEMP_sys_TokenID", ParamName:"OM.sys.TokenID"},{CookieName:"OM_TEMP_sys_AppID", ParamName:"OM.sys.AppID"});
	this.DownloadExtensions	= new Array("xls", "xlsx", "pdf", "doc", "docx", "csv");
	this.ReferrerParameters	= new Array("glcid", "gclid", "q", "p", "text", "z", "wd");
	this.SearchEngines = new Array(new SEngine("google.", "q"), new SEngine("bing.", "q"), new SEngine("yahoo.", "p"), new SEngine("yandex.", "text"), new SEngine("msn.", "q"), new SEngine("baidu.", "wd"), new SEngine("doubleclick.", "z"), new SEngine("ask.", "q"));
	this.CookieParams = new Array(new VL_CP("OM.OSS", "OM_OSS", 1, "OM.voss", this.TD, false, null, false), new VL_CP("OM.cname", "OM_cname", 1, "OM.vcname", this.TD, false, null, false), new VL_CP("OM.cmedium", "OM_cmedium", 1, "OM.vcmedium", this.TD, false, null, false), new VL_CP("OM.csource", "OM_csource", 1, "OM.vcsource", this.TD, false, null, false), 
    new VL_CP("OM.pv", "OM_pv", 1, "OM.vpv", this.TD, false, null, false),
    new VL_CP("OM.pv", "OM_lpvs", 10, "OM.lpvs", this.TD, true, null, true),
    new VL_CP("OM.pp", "OM_lpp", 1, "OM.lpp", this.TD, true, ["OM.ppr"], false),
    new VL_CP("OM.q", "OM_q", 1, "OM.vq", this.TD, false, null, false),
    new VL_CP("OM.rDomain", "OM_rDomain", 1, "OM.vrDomain", this.TD, false, null, false),
    new VL_CP("OM.OSB", "OM_OSB", 1, "OM.vosb", (7 * this.TD), false, ["OM.bzn"], false),
	new VL_CP("OM.sys.TokenID", "OM_sys_TokenID", 1, "OM.sys.TokenID", this.TD, false, null, false),
	new VL_CP("OM.sys.AppID", "OM_sys_AppID", 1, "OM.sys.AppID", this.TD, false, null, false)
    );

	this.PIIParams = new Array(
		"_ExVID",
		"OM.3rd",
		"OM_cmedium",
		"OM_cname",
		"OM_csource",
		"OM_INW",
		"OMB_New",
		"OM_lpp",
		"OM_lpvs",
		"OM_OSB",
		"OM_OSS",
		"OM_pv",
		"OM_q",
		"OM_rDomain",
		"OM_sys_AppID",
		"OM_sys_TokenID",
		"VL_FirstReferrer",
		"VL_FirstVisitTime",
		"VL_LastPageViewTime",
		"VL_LastPVTimeForTD",
		"VL_LastVisitResumes",
		"VL_LastVisitTime",
		"VL_PreviousVisitTime",
		"VL_PVCountInVisit",
		"VL_TotalDuration",
		"VL_TotalPV",
		"VL_TotalVisit",
		"VL_VisitStartTime"
	);

	if(this.RequestProtocol.indexOf("http") == -1){
		this.RequestProtocol = "https";
	}

	this.CheckV1Cookies();
	this.CheckExternalCookies();

	if(document.referrer && document.referrer.toString() != ""){
	
		this.ReferrerURI = parseUri(this.ClearURL(document.referrer.toString()));
		this.CollectSearchEngines();
		this.CreateReferrer();
	}
		
	this.CheckVisitParameters();
	this.CollectDefaultParameters();
	this.RunUserDefinedFunctions("Startup");

	if(this.URI.queryKey["EnableVLDebugger"] && this.URI.queryKey["EnableVLDebugger"] == "true"){
	
		this.EnableDebugger();
	}
}

Visilabs.prototype.CheckExternalCookies = function(){

	if(this.ExternalCookies && this.ExternalCookies != null && this.ExternalCookies.length > 0){

		var	CValue = null;

		for(var i=0; i<this.ExternalCookies.length; i++){

			CValue = this.CookieManager.ReadInternal(this.ExternalCookies[i].CookieName, true);

			if(CValue != null && CValue != ""){

				this.AddParameter(this.ExternalCookies[i].ParamName, CValue);
			}
		}
	}
};

Visilabs.prototype.CheckV1Cookies = function(){

	if(this.CookieManager.ReadInternal("VLCV1OK", true) != "1"){

		var V1Array = new Array();
		var	Value	= null;

		V1Array.push({N:"VL_LastPageViewTime", TD:this.MaxCookieDuration, TT:"D"});
		V1Array.push({N:"VL_LastPVTimeForTD", TD:30, TT:"M"});
		V1Array.push({N:"VL_TotalDuration", TD:this.MaxCookieDuration, TT:"D"});
		V1Array.push({N:"VL_FirstVisitTime", TD:this.MaxCookieDuration, TT:"D"});
		V1Array.push({N:"VL_TotalPV", TD:this.MaxCookieDuration, TT:"D"});
		V1Array.push({N:"VL_PVCountInVisit", TD:30, TT:"M"});
		V1Array.push({N:"VL_VisitStartTime", TD:30, TT:"M"});
		V1Array.push({N:"VL_TotalVisit", TD:this.MaxCookieDuration, TT:"D"});
		V1Array.push({N:"VL_LastVisitTime", TD:this.MaxCookieDuration, TT:"D"});
		V1Array.push({N:"VL_PreviousVisitTime", TD:this.MaxCookieDuration, TT:"D"});
		V1Array.push({N:"VL_LastVisitResumes", TD:30, TT:"M"});
		V1Array.push({N:"VL_FirstReferrer", TD:30, TT:"D"});
		V1Array.push({N:"OfferMiner_ID", TD:this.MaxCookieDuration, TT:"D"});
		V1Array.push({N:"_ExVID", TD:this.MaxCookieDuration, TT:"D"});
		V1Array.push({N:"OM_INW", TD:this.NewCookieTimeout, TT:"DAY"});
		V1Array.push({N:"OMB_New", TD:this.VisitTimeout, TT:"MIN"});
		V1Array.push({N:"VLTVisitC", TD:this.VisitTimeout, TT:"M"});
		V1Array.push({N:"VLTVisitorC", TD:this.NewCookieTimeout, TT:"DAY"});
		V1Array.push({N:"VLTB_VisitC", TD:this.VisitTimeout, TT:"M"});
		V1Array.push({N:"VLTB_VisitorC", TD:this.NewCookieTimeout, TT:"DAY"});
		V1Array.push({N:"VLTB_ABTestC", TD:this.NewCookieTimeout, TT:"DAY"});

		for(var i=0; i<this.CookieParams.length; i++){

			V1Array.push({N:this.CookieParams[i].CName, TD:this.CookieParams[i].Minutes, TT:"M"});
		}

		for(var i=0; i<V1Array.length; i++){

			Value = this.CookieManager.ReadInternal(V1Array[i].N, true);

			if(Value != null){

				this.CookieManager.Set(V1Array[i].N, Value, V1Array[i].TD, V1Array[i].TT);
			}
		}

		this.CookieManager.WriteInternal("VLCV1OK", "1", this.MaxCookieDuration, "D", true);
	}
};

Visilabs.prototype.RunUserDefinedFunctions = function(Type){

	var FunctionList	= null;
	var	ParameterValue	= null;

	eval("FunctionList = this."+ Type +"Functions;");

	if(FunctionList && FunctionList != null && FunctionList.length > 0){

		for(var i=0; i<FunctionList.length; i++){

			ParameterValue = null;

			eval("ParameterValue = "+ FunctionList[i].FunctionName +"();");

			if(FunctionList[i].ParameterName && FunctionList[i].ParameterName != null && FunctionList[i].ParameterName != "" && ParameterValue && ParameterValue != null && ParameterValue != ""){

				this.AddParameter(FunctionList[i].ParameterName, ParameterValue);
			}
		}
	}
};

Visilabs.prototype.CreateReferrer = function(){

	var	RS	= null;
	var	QS	= null;

	RS	= this.ReferrerURI.protocol +"://"+ this.ReferrerURI.authority + this.ReferrerURI.path;

	if(this.ReferrerURI.query && this.ReferrerURI.query != null){

		for(var Key in this.ReferrerURI.queryKey){

			for(var i=0; i<this.ReferrerParameters.length; i++){

				if(Key == this.ReferrerParameters[i]){

					if(QS == null){

						QS	= "?"+ Key +"="+ PrepDecoded(this.ReferrerURI.queryKey[Key]);
					}
					else{

						QS	+= "&"+ Key +"="+ PrepDecoded(this.ReferrerURI.queryKey[Key]);
					}
				}
			}
		}

		if(QS != null){

			RS += QS;
		}
	}

	this.NReferrer	= RS;
};

Visilabs.prototype.CollectSearchEngines = function(){

	var	ParamArr	= null;
	var	Value		= null;
	var	Resume		= false;
	var	ParamName	= null;

	for(var i=0; i<this.SearchEngines.length; i++){

		if(this.ReferrerURI.authority.indexOf(this.SearchEngines[i].Authority) != -1){

			Resume		= true;
			ParamName	= this.SearchEngines[i].QueryParamName;

			break;
		}
	}

	if(Resume && this.ReferrerURI.query && this.ReferrerURI.query != null){

		for(var Key in this.ReferrerURI.queryKey){

			if(Key == ParamName){

				Value	= this.ReferrerURI.queryKey[Key];
				break;
			}
		}
	}

	if(Value != null){

		this.AddParameter("OM.q", Value);
	}
};

Visilabs.prototype.CheckVisitParameters = function(){

	if(!_VLVisitChecked){

		var	PVCountInVisit		= this.GetCookie("VL_PVCountInVisit");
		var	TotalVisitCount		= this.GetCookie("VL_TotalVisit");
		var	TotalPVCount		= this.GetCookie("VL_TotalPV");
		var	LastVisitTime		= this.GetCookie("VL_LastVisitTime");
		var	FirstVisitTime		= this.GetCookie("VL_FirstVisitTime");
		var	VisitStartTime		= this.GetCookie("VL_VisitStartTime");
		var	LastPageViewTime	= this.GetCookie("VL_LastPageViewTime");
		var	TotalDuration		= this.GetCookie("VL_TotalDuration");
		var	LastPVTimeTD		= this.GetCookie("VL_LastPVTimeForTD");
		var	DTLastPVTime		= null;
		var	Now					= new Date();
		var	LastVisitResumes	= null;

		if(LastPVTimeTD != null){

			DTLastPVTime	= this.GenericStringToDate(LastPVTimeTD);
		}
		else{

			DTLastPVTime	= Now;
		}

		this.SetCookie("VL_LastPageViewTime", this.ToLongDateString(new Date(), DateFormat.YYYYMMDD, "-"), this.MaxCookieDuration, "D");
		this.SetCookie("VL_LastPVTimeForTD", this.ToLongDateString(new Date(), DateFormat.YYYYMMDD, "-"), 30, "M");

		if(TotalDuration == null){

			this.SetCookie("VL_TotalDuration", Math.round(((Now - DTLastPVTime) / 1000)), this.MaxCookieDuration, "D");
		}
		else{

			TotalDuration	= Math.round(Number(TotalDuration) + ((Now - DTLastPVTime) / 1000));
			this.SetCookie("VL_TotalDuration", TotalDuration, this.MaxCookieDuration, "D");
		}

		if(FirstVisitTime == null){

			this.SetCookie("VL_FirstVisitTime", this.ToLongDateString(new Date(), DateFormat.YYYYMMDD, "-"), this.MaxCookieDuration, "D");
		}

		if(TotalPVCount != null){

			TotalPVCount	= Number(TotalPVCount) + 1;
			this.SetCookie("VL_TotalPV", TotalPVCount, this.MaxCookieDuration, "D");
		}
		else{

			this.SetCookie("VL_TotalPV", "1", this.MaxCookieDuration, "D");
		}

		if(PVCountInVisit != null){

			PVCountInVisit	= Number(PVCountInVisit) + 1;
			this.SetCookie("VL_PVCountInVisit", PVCountInVisit.toString(), 30, "M");
		}
		else{

			this.SetCookie("VL_PVCountInVisit", "1", 30, "M");
			this.SetCookie("VL_VisitStartTime", this.ToLongDateString(new Date(), DateFormat.YYYYMMDD, "-"), 30, "M");

			if(TotalVisitCount == null){

				this.SetCookie("VL_TotalVisit", "1", this.MaxCookieDuration, "D");
			}
			else{

				TotalVisitCount	= Number(TotalVisitCount) + 1;

				this.SetCookie("VL_TotalVisit", TotalVisitCount.toString(), this.MaxCookieDuration, "D");

				LastVisitResumes = this.GetCookie("VL_LastVisitResumes");

				if(LastVisitResumes == null){

					if(this.GetCookie("VL_LastVisitTime") != null){

						this.SetCookie("VL_PreviousVisitTime", this.GetCookie("VL_LastVisitTime"), this.MaxCookieDuration, "D");
					}
				}

				this.SetCookie("VL_LastVisitTime", this.ToLongDateString(new Date(), DateFormat.YYYYMMDD, "-"), this.MaxCookieDuration, "D");
				this.SetCookie("VL_LastVisitResumes", "1", 30, "M");
			}
		}

		_VLVisitChecked	= true;
	}

	var	VisitPV				= this.GetCookie("VL_PVCountInVisit");
	var	VisitCount			= this.GetCookie("VL_TotalVisit");
	var	TotalPV				= this.GetCookie("VL_TotalPV");
	var	LastVisit			= this.GetCookie("VL_LastVisitTime");
	var	TDuration			= this.GetCookie("VL_TotalDuration");
	var	PreviousVisitTime	= this.GetCookie("VL_PreviousVisitTime");

	if(PreviousVisitTime != null){

		this.AddParameter("OM.pvt", PreviousVisitTime);
	}

	if(VisitPV != null){

		this.AddParameter("OM.pviv", VisitPV);
	}

	if(VisitCount != null){

		this.AddParameter("OM.tvc", VisitCount);
	}

	if(TotalPV != null){

		this.AddParameter("OM.th", TotalPV);
	}

	if(LastVisit != null){

		this.AddParameter("OM.lvt", LastVisit);
	}

	if(TDuration != null && Number(TDuration) > 0){

		this.AddParameter("OM.tvd", TDuration);
	}
};

Visilabs.prototype.CollectDefaultParameters = function(){

	var	TmpValue;

	this.CollectCookieID();
	this.CheckNewVisitor();

	this.AddParameter("OM.resol", screen.width +"x"+ screen.height);
	this.AddParameter("OM.jv", ((navigator.javaEnabled()) ? "Yes" : "No"));
	this.AddParameter("OM.nrv", ((this.IsNew) ? "1" : "0"));
	this.AddParameter("OM.domain", this.URI.authority);
	this.AddParameter("OM.uri", this.URI.path);
	this.AddParameter("OM.title", document.title);

	if(document.referrer){

		this.AddParameter("OM.rDomain", this.NReferrer);

		if(this.URI.authority != this.ReferrerURI.authority){

			this.SetCookie("VL_FirstReferrer", this.NReferrer, 30, "D");
		}
	}

	if(this.Debug){

		if(document.referrer){

			if(this.ReferrerURI.authority != this.URI.authority){

				if(document.referrer.toString().length > 50){

					this.AddParameter("OM.dbg_referrer", document.referrer.toString().substring(0, 50));
				}
				else{

					this.AddParameter("OM.dbg_referrer", document.referrer.toString());
				}
			}
		}
	}

	TmpValue	= this.GetCookie("VL_FirstReferrer");

	if(TmpValue != null){

		this.AddParameter("OM.vrdomain", TmpValue);
	}

	TmpValue = getFlashVersion();

	if(TmpValue != null && TmpValue != ""){

		this.AddParameter("OM.fv", TmpValue);
	}

	TmpValue = this.GetCookie("_ExVID");

	if(TmpValue != null && TmpValue != ""){

		this.AddParameter("OM.exVisitorID", TmpValue);
	}

	if(this.URI != null){

		for(var Key in this.URI.queryKey){

			this.AddParameter(Key, this.URI.queryKey[Key]);
		}
	}
};

Visilabs.prototype.CollectCookieID = function(){

	var	_TmpVal	= this.GetCookie("OfferMiner_ID");

	if(_TmpVal != null && _TmpVal != ""){

		this.CookieID	= _TmpVal;
	}
	else{

		this.CreateCookieID();
		this.CookieID = this.GetCookie("OfferMiner_ID");
	}
};

Visilabs.prototype.GenerateGUID = function(){

	var a = new Date();
	var b = a.getUTCFullYear();
	var c = a.getMonth() + 1;
	var d = a.getDate();
	var e = a.getHours();
	var f = a.getMinutes();
	var g = a.getSeconds();
	var s = "";

	if (parseInt(c) < 10) { c = "0" + c }
	if (parseInt(d) < 10) { d = "0" + d }
	if (parseInt(e) < 10) { e = "0" + e }
	if (parseInt(f) < 10) { f = "0" + f }
	if (parseInt(g) < 10) { g = "0" + g }

	for(i=0; i<16; i++)
	{
		s += String.fromCharCode(65 + Math.round(Math.random() * 25))
	}

	s += "" + b + c + d + e + f + g;

	return s;
};

Visilabs.prototype.CreateCookieID = function(){

	var GUID = this.GenerateGUID();

	this.SetCookie("OfferMiner_ID", GUID, this.MaxCookieDuration, "D");
	this.CookieManager.WriteInternal("OfferMiner_ID", GUID, this.MaxCookieDuration, "D", true);

	return GUID;
};

Visilabs.prototype.AddParameter = function(Name, Value){

	this.Parameters[Name] = PrepEncoded(Value);

	try
	{
		if(typeof(window.VisiParameters) == typeof(undefined)){

			window.VisiParameters = new Object();
		}

		window.VisiParameters[Name] = PrepEncoded(Value);
	}
	catch(Ex){}
};

Visilabs.prototype.ParameterExists = function(Name){

	if(this.Parameters[Name] && this.Parameters[Name] != null && this.Parameters[Name] != ""){

		return true;
	}

	return false;
};

Visilabs.prototype.SetCookie = function(Name, Value, Timeout, TimeoutType){

	this.CookieManager.Set(Name, Value, Timeout, TimeoutType);
};

Visilabs.prototype.GetCookie = function(Name){

	return this.CookieManager.Get(Name);
};

Visilabs.prototype.CleanUp = function(){

	this.Parameters	= new Object();
};

Visilabs.prototype.Recollect = function(Params){

	for(var i=0; i<Params.length; i++){

		this.AddParameter(Params[i][0], Params[i][1]);
	}

	this.WriteCookieParameters();
	this.SendSegmentRequest();
};

Visilabs.prototype.OnExVisitorIDChanged = function(){

	if(this.ParameterExists("OM.exVisitorID")){

		var	TmpValue = this.GetCookie("_ExVID");

		if(this.Parameters["OM.exVisitorID"].toString() != PrepEncoded(TmpValue)){

			this.SetCookie("OfferMiner_ID", "", this.MaxCookieDuration, "D");
			this.CookieManager.WriteInternal("OfferMiner_ID", "", this.MaxCookieDuration, "D", true);

			if(!this.ParameterExists("OM.oldExVisitorID") && !this.ParameterExists("OM.old.exVisitorID")){

				this.CollectCookieID();
				this.ClearCookieParams();
			}
		}
	}
};

Visilabs.prototype.ClearCookieParams = function(){

	for(var i=0; i<this.CookieParams.length; i++){

		try
		{
			this.SetCookie(this.CookieParams[i].CName, "", -1, "D");
		}
		catch(Ex){};
	}
};

Visilabs.prototype.Collect = function(){
	if (this.TrackHandler("check")) return;
	if(_SendPageLoadTime){

		if(_PageLoadFinish != null){

			this.AddParameter("OM.pld", (_PageLoadFinish - _PageLoadStart) / 1000);
			this.CollectB();
		}
		else{

			var	_this	= this;
			setTimeout(function(){_this.Collect();}, 500);
		}
	}
	else{

		this.CollectB();
	}
};

Visilabs.prototype.CollectB = function(){

	if(this.GetCookie("_ExVID") == null){

		this.WriteExVisitorID();
	}

	this.OnExVisitorIDChanged();
	this.WriteCookieParameters();
	this.RunUserDefinedFunctions("Collect");
	this.SendSegmentRequest();
};

Visilabs.prototype.WriteExVisitorID = function(){
	if (this.ParameterExists("OM.exVisitorID")) {
		if (!this.TrackHandler("check")) {
			this.SetCookie("_ExVID", this.Parameters["OM.exVisitorID"], this.MaxCookieDuration, "DAY");
			this.CookieManager.WriteInternal("_ExVID", this.Parameters["OM.exVisitorID"], this.MaxCookieDuration, "DAY", true);
		} else {
			delete this.Parameters["OM.exVisitorID"];
		}
	}
};

Visilabs.prototype.SendSegmentRequest = function(){

	var	Dt		= new Date();
	var	Img		= new Image();
	var	ImgRt	= new Image();
	var	Src		= null;
	var	_this	= this;

	Src	 = this.RequestProtocol + "://" + "[DOMAIN]" + this.DataSource + "/om.gif?OM.siteID=" + this.SiteID + ((this.CookieID != null) ? ("&OM.cookieID=" + this.CookieID) : "") +"&OM.oid="+ this.OrganizationID;

	this.WriteExVisitorID();

	for(var Key in this.Parameters){

		Src	+= "&"+ Key +"="+ this.Parameters[Key];
		if (this.DontTrack == Key)
			this.TrackHandler("init");
	}

	this.CookieManager.WriteInternal("OfferMiner_ID", this.CookieID, this.MaxCookieDuration, "D", true);

	Img.src		= Src.split("[DOMAIN]").join(this.SegmentURL) +"&dat="+ Dt.toUTCString();
	ImgRt.src	= Src.split("[DOMAIN]").join(this.RealtimeURL) +"&dat="+ Dt.toUTCString();
};

Visilabs.prototype.TrackHandler = function (key) {
	if (key == "init") {
		this.CookieManager.WriteInternal(this.DontTrack, "true", this.MaxCookieDuration, "D");
	}
	if (key == "check") {
		if (this.CookieManager.ReadInternal(this.DontTrack) != null) {
			this.PIIClear();
			return true;
		}
		else
			return false;
	}
};

Visilabs.prototype.PIIClear = function () {
	var _self = this;
	this.PIIParams.forEach(function(param){
		_self.SetCookie(param, "", -1, "D");
		if (param == "_ExVID")
			_self.CookieManager.WriteInternal(param, "", -1, "D");
		if (param == "OM.3rd")
			_self.CookieManager.WriteInternal(param, "", -1, "D");
	});

	_self.CookieManager.WriteInternal("OfferMiner_ID", "", -1, "D");
	_self.CookieManager.WriteInternal("OM.3rd", "", -1, "D");
};

Visilabs.prototype.ClearURL = function(url){

	return url.split("@").join("%40");
};

Visilabs.prototype.WriteCookieParameters = function(){

	var	CValue;
	var	TmpArr;
	var	LastValue;
	var	CurrentValue;
	var	WriteAvailable;
	var	ItemsToRemove;
	var TmpValue;

	if (!_IsTargetEnabled && !_IsWidgetEnabled) {
		var temp_CookieParams = [];
		for (var i = 0; i < this.CookieParams.length; i++) {
			if (this.CookieParams[i].ParameterName != null && this.CookieParams[i].ParameterName != "" && this.CookieParams[i].ParameterName != "OM.vpv" && this.CookieParams[i].ParameterName != "OM.lpvs"
				&& this.CookieParams[i].ParameterName != "OM.lpp" && this.CookieParams[i].ParameterName != "OM.vq" && this.CookieParams[i].ParameterName != "OM.vosb") {
				temp_CookieParams.push(this.CookieParams[i]);
			}
		}
		this.CookieParams = temp_CookieParams;
	}

	for(var i=0; i<this.CookieParams.length; i++){

		if(this.Parameters[this.CookieParams[i].Name] && this.Parameters[this.CookieParams[i].Name] != ""){

			ItemsToRemove	= new Array();
			CValue			= this.GetCookie(this.CookieParams[i].CName);
			TmpArr			= new Array();
			LastValue		= null;
			WriteAvailable	= true;

			if(CValue != null && CValue != ""){

				TmpArr		= CValue.split("~");
				LastValue	= PrepDecoded((this.CookieParams[i].CollectDate) ? TmpArr[0].split("|")[0] : TmpArr[0]);

				if(LastValue != null){

					if(this.CookieParams[i].CollectDate){

						LastValue	= PrepDecoded(LastValue.split("|")[0]);
					}
					else{

						LastValue	= PrepDecoded(LastValue);
					}
				}

				if(this.CookieParams[i].WriteDistinct == true){

					for(var t=0; t<TmpArr.length; t++){

						TmpValue = PrepDecoded((this.CookieParams[i].CollectDate) ? PrepDecoded(TmpArr[t]).split("|")[0] : TmpArr[0]);

						if(TmpValue == this.Parameters[this.CookieParams[i].Name]){

							ItemsToRemove.push(TmpArr[t]);
							WriteAvailable	= true;
						}
					}
				}

				if(LastValue != PrepDecoded(this.Parameters[this.CookieParams[i].Name]) && WriteAvailable){

					if(TmpArr.length > this.CookieParams[i].Count-1){

						TmpArr.splice(this.CookieParams[i].Count-1, 1);
					}
				}
			}

			if(WriteAvailable){

				CurrentValue = this.Parameters[this.CookieParams[i].Name];

				if(this.CookieParams[i].RelatedParameters && this.CookieParams[i].RelatedParameters != null){

					for(var j=0; j<this.CookieParams[i].RelatedParameters.length; j++){

						if(this.Parameters[this.CookieParams[i].RelatedParameters[j]] && this.Parameters[this.CookieParams[i].RelatedParameters[j]] != ""){

							CurrentValue += "|"+ this.Parameters[this.CookieParams[i].RelatedParameters[j]];
						}
					}
				}

				if(this.CookieParams[i].CollectDate){

					CurrentValue += "|"+ this.ToLongDateString(new Date(), DateFormat.YYYYMMDD, "-");
				}

				if(this.CookieParams[i].Count > 1){

					TmpArr.splice(0, 0, CurrentValue);
				}
				else{

					TmpArr = new Array(CurrentValue);
				}

				for(var r=0; r<ItemsToRemove.length; r++){

					for(var s=0; s<TmpArr.length; s++){

						if(TmpArr[s] == ItemsToRemove[r]){

							TmpArr.splice(s, 1);
							break;
						}
					}
				}

				TmpArr	= TmpArr.join("~");

				this.SetCookie(this.CookieParams[i].CName, PrepEncoded(TmpArr), this.CookieParams[i].Minutes, "M");

				if(this.CookieParams[i].ParameterName != null && this.CookieParams[i].ParameterName != ""){

					this.AddParameter(this.CookieParams[i].ParameterName, TmpArr);
				}
			}
		}
	}

	for(var i=0; i<this.CookieParams.length; i++){

		CValue	= this.GetCookie(this.CookieParams[i].CName);

		if(CValue != null){

			if(this.CookieParams[i].ParameterName != null && this.CookieParams[i].ParameterName != ""){

				this.AddParameter(this.CookieParams[i].ParameterName, CValue);
			}
		}
	}
};

Visilabs.prototype.CheckNewVisitor = function(){

	var	CookieArr	= document.cookie.split(";");
	var	OMB_INW		= this.GetCookie("OM_INW");
	var	OMB_New		= this.GetCookie("OMB_New");

	if(OMB_INW == null){

		this.IsNew	= true;

		this.SetCookie("OM_INW", "1", this.NewCookieTimeout, "DAY");
		this.SetCookie("OMB_New", "1", this.VisitTimeout, "MIN");
	}
	else{

		if(OMB_New != null){

			this.IsNew	= true;
			this.SetCookie("OMB_New", "1", this.VisitTimeout, "MIN");
		}
	}
};

Visilabs.prototype.GenericStringToDate = function(_Date){

	var	Arr		= _Date.split(" ");
	var	DArr	= Arr[0].split("-");
	var	TArr	= Arr[1].split(":");

	return new Date(Number(DArr[0]), Number(DArr[1])-1, Number(DArr[2]), Number(TArr[0]), Number(TArr[1]), Number(TArr[2]));
};

Visilabs.prototype.ToLongDateString = function(_Date, _Format, _Seperator){

	var	_Month;
	var	_Day;
	var	_Hour;
	var	_Minute;
	var	_Second;
	var	Seperator;

	if(_Seperator && _Seperator != null){

		Seperator	= _Seperator;
	}
	else{

		Seperator	= ".";
	}

	if(_Date.getMonth() + 1 < 10){

		_Month	= "0"+ (_Date.getMonth() + 1);
	}
	else{

		_Month	= (_Date.getMonth() + 1);
	}

	if(_Date.getDate() < 10){

		_Day	= "0"+ _Date.getDate();
	}
	else{

		_Day	= _Date.getDate();
	}

	if(_Date.getHours() < 10){

		_Hour	= "0"+ _Date.getHours();
	}
	else{

		_Hour	= _Date.getHours();
	}

	if(_Date.getMinutes() < 10){

		_Minute	= "0"+ _Date.getMinutes();
	}
	else{

		_Minute	= _Date.getMinutes();
	}

	if(_Date.getSeconds() < 10){

		_Second	= "0"+ _Date.getSeconds();
	}
	else{

		_Second	= _Date.getSeconds();
	}

	switch(_Format)
	{
		case DateFormat.DDMMYYYY:
		{
			return _Day + Seperator + _Month + Seperator + _Date.getFullYear() +" "+ _Hour +":"+ _Minute +":"+ _Second;
		}
		case DateFormat.MMDDYYYY:
		{
			return _Month + Seperator + _Day + Seperator + _Date.getFullYear() +" "+ _Hour +":"+ _Minute +":"+ _Second;
		}
		case DateFormat.YYYYMMDD:
		{
			return _Date.getFullYear() + Seperator + _Month + Seperator + _Day +" "+ _Hour +":"+ _Minute +":"+ _Second;
		}
	}

	return null;
};

Visilabs.prototype.Suggest = function (ZoneID, ContentID, ProductCode, Callback, OnErrorCallback, Filter) {
	var Owner = this;
	var VTarget = new VisilabsTarget(ContentID, Owner, Callback, OnErrorCallback);
	var FVL = "";

	if (ZoneID != null && ZoneID != "") {

		VTarget.AddParameter("OM.zid", ZoneID);
	}

	if (ProductCode != null && ProductCode != "") {

		VTarget.AddParameter("OM.body", ProductCode);
	}

	FVL = VL_FVL_Convert(Filter);

	if (FVL != null && FVL != "") {

		VTarget.AddParameter("OM.w.f", FVL);
	}

	VTarget.Collect();
};

Visilabs.prototype.SuggestActions = function (Callback, OnErrorCallback, ContentID) {
	var Owner = this;
	var VTarget = new VisilabsTarget(ContentID, Owner, Callback, OnErrorCallback);

	setTimeout(function () { VTarget.CollectActions(); }, 10);
};

function VL_FVL_Convert(Filter){
	var result = "";
	if(Filter != undefined && Array.isArray(Filter) && Filter != null && Filter.length>0){
		var result = "{";
		result += "\"operand\":"+VL_OfferOperator.AND+",";
		result += "\"filters\":[";
		for(var i = 0;i<Filter.length;i++){
			if (i > 0) {

				result += ",";
			}

			result += "{\"attr\":\"" + Filter[i].Name + "\",\"ft\":" + Filter[i].Type + ",\"fv\":\"" + Filter[i].Value + "\"}";
		}
		result += "]}";

	}
	else if(Filter != undefined && Filter.hasOwnProperty("operand") && Filter.hasOwnProperty("filters") && Filter.filters != null && Filter.filters.length>0){
		result += "{";
		result += "\"operand\":"+Filter.operand+",";
		result += "\"filters\":[";
		for(var i = 0;i<Filter.filters.length;i++){
			if (i > 0) {

				result += ",";
			}

			result += "{\"attr\":\"" + Filter.filters[i].Name + "\",\"ft\":" + Filter.filters[i].Type + ",\"fv\":\"" + Filter.filters[i].Value + "\"}";
		}
		result += "]}";
	}
	return result;
}

Visilabs.prototype.CollectClicks = function(){

	var	_this			= this;
	var	Anchors			= document.getElementsByTagName("a");
	var	Anchor			= null;
	var	AnchorURI		= null;
	var	FileExtension	= null;
	var	FileName		= null;
	var	FileNameArray	= null;
	var	Href			= null;

	for(var Key in Anchors){

		Anchor	= Anchors[Key];

		if(Anchor.className && Anchor.className.indexOf("visianchor") != -1 && Anchor.href && Anchor.href != "" && Anchor.href != "javascript:void(0)"){

			Href = Anchor.href;

			if(typeof(Anchor.target) == typeof(undefined) || (Anchor.target != "_blank")){

				Anchor.setAttribute("visihref", Anchor.href);

				Anchor.href			= "javascript:void(0)";
				Anchor.style.cursor	= "pointer";
			}

			if(window.attachEvent){

				Anchor.attachEvent("onclick", function(e){_this.FollowAnchorClick(e);});
			}
			else{

				Anchor.addEventListener("click", function(e){_this.FollowAnchorClick(e);}, false);
			}

			AnchorURI	= parseUri(Href);

			if(AnchorURI["file"]){

				FileName		= AnchorURI["file"].split("?")[0];
				FileNameArray	= FileName.split(".");
				FileExtension	= FileNameArray[FileNameArray.length-1].toLowerCase();
			}
			else{

				FileExtension	= null;
			}

			if(FileExtension != null){

				for(var i=0; i<this.DownloadExtensions.length; i++){

					if(FileExtension == this.DownloadExtensions[i]){

						if(Anchor.attributes["vlkeys"]){

							if(Anchor.attributes["vlkeys"].value != ""){

								Anchor.setAttribute("vlkeys", Anchor.attributes["vlkeys"].value +";OM.df");
								Anchor.setAttribute("vlvalues", Anchor.attributes["vlvalues"].value +";"+ FileName);
							}
							else{

								Anchor.setAttribute("vlkeys", "OM.df");
								Anchor.setAttribute("vlvalues", FileName);
							}
						}
						else{

							Anchor.setAttribute("vlkeys", "OM.df");
							Anchor.setAttribute("vlvalues", FileName);
						}

						break;
					}
				}
			}
		}
	}
};

Visilabs.prototype.CollectDownloadLinks = function(){

	var	_this			= this;
	var	Anchors			= document.getElementsByTagName("a");
	var	Anchor			= null;
	var	AnchorURI		= null;
	var	FileExtension	= null;
	var	FileName		= null;
	var	FileNameArray	= null;
	var	Resume			= false;

	for(var Key in Anchors){

		Anchor	= Anchors[Key];
		Resume	= false;

		if(Anchor.href && Anchor.href != "" && Anchor.href != "javascript:void(0)"){

			AnchorURI	= parseUri(Anchor.href);

			if(AnchorURI["file"]){

				FileName		= AnchorURI["file"].split("?")[0];
				FileNameArray	= FileName.split(".");
				FileExtension	= FileNameArray[FileNameArray.length-1].toLowerCase();

				for(var i=0; i<this.DownloadExtensions.length; i++){

					if(FileExtension == this.DownloadExtensions[i]){

						Resume	= true;
						break;
					}
				}
			}
			else{

				FileExtension	= null;
			}

			if(FileExtension != null && Resume){

				if((typeof(Anchor.target) == typeof(undefined)) || (Anchor.target.toString() != "_blank")){

					Anchor.setAttribute("visihref", Anchor.href);

					Anchor.href			= "javascript:void(0)";
					Anchor.style.cursor	= "pointer";
				}

				if(window.attachEvent){

					Anchor.attachEvent("onclick", function(e){_this.FollowAnchorClick(e);return false;});
				}
				else{

					Anchor.addEventListener("click", function(e){_this.FollowAnchorClick(e);return false;}, false);
				}

				for(var i=0; i<this.DownloadExtensions.length; i++){

					if(FileExtension == this.DownloadExtensions[i]){

						if(Anchor.attributes["vlkeys"]){

							if(Anchor.attributes["vlkeys"].value != ""){

								Anchor.setAttribute("vlkeys", Anchor.attributes["vlkeys"].value +";OM.df");
								Anchor.setAttribute("vlvalues", Anchor.attributes["vlvalues"].value +";"+ FileName);
							}
							else{

								Anchor.setAttribute("vlkeys", "OM.df");
								Anchor.setAttribute("vlvalues", FileName);
							}
						}
						else{

							Anchor.setAttribute("vlkeys", "OM.df");
							Anchor.setAttribute("vlvalues", FileName);
						}

						break;
					}
				}
			}
		}
	}
};

Visilabs.prototype.FollowAnchorClick = function(e){

	var	hWnd	= FindParentByAttr((e && e.target) ? e.target : event.srcElement, "visihref");
	var	Keys	= (hWnd.attributes["vlkeys"] && hWnd.attributes["vlkeys"].value != "") ? hWnd.attributes["vlkeys"].value.split(";") : null;
	var	Values	= (hWnd.attributes["vlvalues"] && hWnd.attributes["vlvalues"].value != "") ? hWnd.attributes["vlvalues"].value.split(";") : null;
	var	Anchor	= (hWnd.attributes["visihref"] && hWnd.attributes["visihref"].value != "") ? hWnd.attributes["visihref"].value : hWnd.href;
	var	Dt		= new Date();
	var	Img		= new Image();
	var	Src		= null;

	if(Keys != null && Values != null && Anchor != null){

		Src	 = this.RequestProtocol + "://" + "[DOMAIN]" + this.DataSource + "/om.gif?OM.cookieID=" + this.CookieID + "&OM.siteID=" + this.SiteID +"&OM.oid="+ this.OrganizationID;

		for(var Key in this.Parameters){

			if(Key == "OM.exVisitorID"){

				Src	+= "&"+ Key +"="+ this.Parameters[Key];
			}
		}

		for(var i=0; i<Keys.length; i++){

			if(i < Values.length){

				Src	+= "&"+ Keys[i] +"="+ PrepEncoded(Values[i]);
			}
		}

		Img.src		= Src.split("[DOMAIN]").join(this.SegmentURL) +"&dat="+ Dt.toUTCString();

		if(typeof(hWnd.target) == typeof(undefined) || (hWnd.target != "_blank")){

			Img.onload	= function(){document.location.href = Anchor};
			Img.onerror	= function(){document.location.href = Anchor};
		}
	}
};

Visilabs.prototype.EnableDebugger = function(){

	this.DebuggerEnabled = true;

	if(this.Debugger == null){

		var	_this     = this;
		this.Debugger = new VisilabsDebugger(_this, function(Command){_this.OnDebuggerCommandArrive(Command);});
	}

	this.Debugger.Show();
};

Visilabs.prototype.DisableDebugger = function(){

	this.DebuggerEnabled = false;

	if(this.Debugger != null){

		this.Debugger.Hide();
	}
};

Visilabs.prototype.OnDebuggerCommandArrive = function(RawCommand){

	var	Command;

	if(Text != null && Text != ""){

		Command = RawCommand.split(" ");

		switch(Command[0])
		{
			case "FilterCookie":
			case "ShowCookies":
			{
				var	Filter	= null;
				var	Vault	= this.CookieManager.ParseInternal();
				var	HTML	= "<ul>";

				if(Command[0] == "FilterCookie"){

					Filter = Command[1];
				}

				for(var i=0; i<Vault.Items.length; i++){

					if(Filter == null || Vault.Items[i].K == Filter){

						HTML += "<li>";
						HTML += "<b>Key    : </b>"+ Vault.Items[i].K +"<br/>";
						HTML += "<b>Value  : </b>"+ Vault.Items[i].V +"<br/>";
						HTML += "<b>Expires: </b>"+ Vault.Items[i].E +"<br/><br/>";

						HTML += "</li>";
					}
				}

				HTML  += "</ul>";

				this.Debugger.WriteResponse(HTML);

				break;
			}
			case "ClearScreen":
			{
				this.Debugger.ClearResponseBox();
				break;
			}
		}

		this.Debugger.ScrollToBottom();
	}
};

Visilabs.prototype.SendMailSubscriptionRequest = function (actid, auth, email) {
	var Dt = new Date();
	var Img = new Image();
	var Src = null;
	var _this = this;
	Src = this.RequestProtocol + "://" + "[DOMAIN]" + "subsjson?OM.siteID=" + this.SiteID + ((this.CookieID != null) ? ("&OM.cookieID=" + this.CookieID) : "") + "&OM.oid=" + this.OrganizationID;
	Src = Src + "&type=subscription_email&actionid=" + actid + "&auth=" + auth + "&OM.subsemail=" + PrepEncoded(email);
	Src = this.ParameterExists("OM.exVisitorID") ? (Src + "&OM.exVisitorID=" + PrepEncoded(this.Parameters["OM.exVisitorID"].toString())) : Src;
	Img.src = Src.split("[DOMAIN]").join(this.TargetURL) + "&dat=" + Dt.toUTCString();
};

Visilabs.prototype.SendClickRequest = function (ActType, ActID) {
	var Dt = new Date();
	var Img = new Image();
	var Src = null;
	var CookieID = (this.CookieID != null) ? this.CookieID : "";
	Src = this.RequestProtocol + "://" + "[DOMAIN]" + this.DataSource + "/om.gif?OM.siteID=" + this.SiteID + "&OM.oid=" + this.OrganizationID + "&OM.cookieID=" + CookieID + "&OM.uri=/om_evt.gif&OM.zn=acttype-" + ActType + "&OM.zpc=act-" + ActID + "&OM.num1=1";
	Img.src = Src.split("[DOMAIN]").join(this.SegmentURL) + "&dat=" + Dt.toUTCString();
};

Visilabs.prototype.SubscriptionWorker = function (actid, auth, email, isExitIntent) {
	this.SendMailSubscriptionRequest(actid, auth, email);
	this.SendClickRequest(26, actid);
	var cappingArray = this.GetCookie("OM_subscap") == null ? [] : this.GetCookie("OM_subscap").split('|');
	if (cappingArray.indexOf(actid.toString()) < 0)
		cappingArray.push(actid.toString());
	var newCapping = cappingArray.join('|');
	this.SetCookie("OM_subscap", newCapping, this.MaxCookieDuration, "D");

	if (isExitIntent !== undefined && isExitIntent) {
		bioEp.hidePopup();
	} else {
		visi_lightbox_remove();
	}
};



function VisilabsDebugger(Owner, OnCommandArrived){

	this.Owner				= Owner;
	this.Created			= false;
	this.OnCommandArrived	= OnCommandArrived;
	this.Base				= null;
	this.CommandBox			= null;
	this.ResponseBox		= null;
	this.Width				= 400;
	this.Height				= 400;
	this.BasePadding		= 2;
	this.BaseBorder			= 1;
	this.PagePadding		= 10;
	this.BaseBorderColor	= "#999999";
}

VisilabsDebugger.prototype.Create = function(){

	var	_this = this;

	this.Base							= document.createElement("div");
	this.Base.style.border				= this.BaseBorderColor +" "+ this.BaseBorder +"px solid";
	this.Base.style.position			= "absolute";
	this.Base.style.zIndex				= "10000";
	this.Base.style.padding				= this.BasePadding.toString() +"px";
	this.Base.style.display				= "none";
	this.Base.style.backgroundColor		= "#ffffff";
	this.Base.style.boxShadow			= "0px 0px 10px #999999";

	this.CommandBox						= document.createElement("input");
	this.CommandBox.type				= "text";
	this.CommandBox.style.border		= this.BaseBorderColor +" "+ this.BaseBorder +"px solid";
	this.CommandBox.style.fontFamily	= "Courier New";
	this.CommandBox.style.fontSize		= "12px";

	this.ResponseBox					= document.createElement("div");
	this.ResponseBox.style.marginTop	= this.BasePadding.toString() +"px";
	this.ResponseBox.style.border		= this.BaseBorderColor +" "+ this.BaseBorder +"px solid";
	this.ResponseBox.style.overflow		= "auto";
	this.ResponseBox.style.fontFamily	= "Courier New";
	this.ResponseBox.style.fontSize		= "12px";
	this.ResponseBox.style.whiteSpace	= "pre";

	this.Base.appendChild(this.CommandBox);
	this.Base.appendChild(this.ResponseBox);

	document.body.appendChild(this.Base);

	if(window.attachEvent){

		this.CommandBox.attachEvent("onkeypress", function(e){return _this.OnKeyPress(e);});
		window.attachEvent("onresize", function(){return _this.SetPosition();});
	}
	else{

		this.CommandBox.addEventListener("keypress", function(e){return _this.OnKeyPress(e);}, false);
		window.addEventListener("resize", function(){return _this.SetPosition();}, false);
	}

	this.Created = true;
};

VisilabsDebugger.prototype.Show = function(){

	if(!this.Created){

		this.Create();
	}

	this.Base.style.display	= "";

	this.SetSize();
	this.SetPosition();
};

VisilabsDebugger.prototype.Hide = function(){

	this.Base.style.display	= "none";
};

VisilabsDebugger.prototype.SetPosition = function(){

	this.Base.style.left	= (document.documentElement.clientWidth - this.Base.clientWidth - (this.BaseBorder * 2) - this.PagePadding).toString() +"px";
	this.Base.style.top		= this.PagePadding.toString() +"px";
};

VisilabsDebugger.prototype.SetSize = function(){

	this.Base.style.width			= this.Width.toString() +"px";
	this.Base.style.height			= this.Height.toString() +"px";
	this.CommandBox.style.width		= (this.Width - (this.BaseBorder * 2)).toString() +"px";
	this.ResponseBox.style.height	= (this.Height - this.CommandBox.clientHeight - (this.BasePadding * 3) - (this.BaseBorder * 2)).toString() +"px";
};

VisilabsDebugger.prototype.Resize = function(Width, Height){

	if(this.Created){

		this.Width	= Width;
		this.Height	= Height;

		this.SetSize();
		this.SetPosition();
	}
};

VisilabsDebugger.prototype.ScrollToBottom = function(){

	this.ResponseBox.scrollTop = this.ResponseBox.scrollHeight;
};

VisilabsDebugger.prototype.OnKeyPress = function(e){

	var	hCode;

	if(e && e.target){

		hCode	= e.keyCode;
	}
	else{

		hCode	= event.keyCode;
	}

	if(hCode == 13){

		if(e && e.target){

			e.cancelBubble	= true;
			e.preventDefault();
		}
		else{

			event.cancelBubble	= true;
		}

		if(this.OnCommandArrived != null){

			this.OnCommandArrived(this.CommandBox.value);
			this.CommandBox.value = "";
		}
	}
	else{

		return false;
	}
};

VisilabsDebugger.prototype.WriteResponse = function(Response){

	this.ResponseBox.innerHTML = this.ResponseBox.innerHTML + "<br/>" + Response;
};

VisilabsDebugger.prototype.ClearResponseBox = function(){

	this.ResponseBox.innerHTML = "";
};

function VLCookieManager(Owner){

	this.Owner					= Owner;
	this.KeyBase				= "VL_CM_";
	this.MaxCookieCount			= 50;
	this.MaxCookieLength		= 6000;
	this.MaxLocalStorageLength	= 100000;
	this.LocalStorageAvailable	= this.IsLocalStorageAvailable();
}

VLCookieManager.prototype.Set = function(Key, Value, Timeout, TimeoutType){

	var	Found		= false;
	var	TItem		= null;
	var	ExpireDate	= this.ToLongDateString(this.CreateTimeoutDate(Timeout, TimeoutType));
	var	Vault		= this.ParseInternal();
	Value		= PrepEncoded(Value);

	for(var i=0; i<Vault.Items.length; i++){

		if(Vault.Items[i].K == Key){

			Vault.Items[i].V = Value;
			Vault.Items[i].E = ExpireDate;

			Found = true;
			break;
		}
	}

	if(!Found){

		TItem	= new VLCookieManagerVaultItem();
		TItem.K	= Key;
		TItem.V	= Value;
		TItem.E	= ExpireDate;

		Vault.Items.push(TItem);
	}

	this.StringfyInternal(Vault);
};

VLCookieManager.prototype.Get = function(Key){

	var	Vault		= this.ParseInternal();
	var	Value		= null;
	var	Now			= new Date();
	var	ExpireDate	= null;

	if(Vault != null && Vault.Items != null){

		for(var i=0; i<Vault.Items.length; i++){

			if(Vault.Items[i].K == Key){

				ExpireDate = this.ToLongDate(Vault.Items[i].E);

				if(ExpireDate > Now){

					Value = PrepDecoded(Vault.Items[i].V);
				}

				break;
			}
		}
	}

	return Value;
};

VLCookieManager.prototype.StringfyInternal = function(Vault){


	if (!_IsTargetEnabled && !_IsWidgetEnabled) {
		var Temp_Vault_Items = [];
		for (var i = 0; i < Vault.Items.length; i++) {
			if (Vault.Items[i].K != null && Vault.Items[i].K != "" && Vault.Items[i].K != "OM_pv" && Vault.Items[i].K != "OM_lpvs"
				&& Vault.Items[i].K != "OM_lpp" && Vault.Items[i].K != "OM_q" && Vault.Items[i].K != "OM_OSB") {
				Temp_Vault_Items.push(Vault.Items[i]);
			}
		}
		Vault.Items = Temp_Vault_Items;
	}

	var	Total	= JSON.stringify(Vault);
	var	Section	= null;
	var	Count	= 0;
	var	TVal	= "";
	var	Length	= (this.Owner.UseLocalStorage && this.LocalStorageAvailable) ? this.MaxLocalStorageLength : this.MaxCookieLength;

	if(Total != null && Total != ""){

		for(var i=0; i<this.MaxCookieCount; i++){

			TVal = this.ReadInternal(this.KeyBase + i.toString(), false);

			if(TVal != null && TVal != ""){

				this.WriteInternal(this.KeyBase + i.toString(), "", -1, "D", true);

				if(this.LocalStorageAvailable){

					localStorage.removeItem(this.KeyBase + i.toString());
				}
			}
			else{

				break;
			}
		}

		Total = encodeURIComponent(Total);

		for(var i=0; i<Total.length; i=i+Length){

			if(i<Total.length){

				Section	= Total.substring(i, i+Length);

				if(Section != ""){

					this.WriteInternal(this.KeyBase + Count.toString(), Section, this.Owner.NewCookieTimeout, "D", false);
					Count++;
				}
			}
			else{

				break;
			}
		}
	}
};

VLCookieManager.prototype.ParseInternal = function(){

	var	TVal		= "";
	var	Total		= "";
	var	Vault		= null;
	var	ExpireDate	= null;
	var	Now			= new Date();

	for(var i=0; i<this.MaxCookieCount; i++){

		TVal = this.ReadInternal(this.KeyBase + i.toString(), false);

		if(TVal != null && TVal != ""){

			Total += TVal;
		}
		else{

			break;
		}
	}

	if(Total != null && Total != ""){

		try
		{
			Total = PrepDecoded(Total);
			Vault = JSON.parse(Total);
		}
		catch(Ex)
		{
			Vault = new VLCookieManagerVault();
		}
	}
	else{

		Vault = new VLCookieManagerVault();
	}

	var Num = 0;

	while(Num < Vault.Items.length){

		ExpireDate = this.ToLongDate(Vault.Items[Num].E);

		if(ExpireDate <= Now){

			Vault.Items.splice(Num, 1);
			Num = 0;
		}
		else{

			Num++;
		}
	}

	return Vault;
};

VLCookieManager.prototype.ReadInternal = function(Name, CookieModeOnly){

	var	CookieArr	= document.cookie.split(";");
	var	Val			= null;
	var	Medium		= (!CookieModeOnly && this.Owner.UseLocalStorage && this.LocalStorageAvailable) ? "LS" : "C";

	if(Medium == "C"){

		for(var i=0; i<CookieArr.length; i++){

			while(CookieArr[i].charAt(0) == " "){

				CookieArr[i] = CookieArr[i].substring(1, CookieArr[i].length);
			}

			if (CookieArr[i].indexOf(Name + "=") >= 0){

				Val	= CookieArr[i].substring((Name + "=").length, CookieArr[i].length);
			}
		}
	}
	else{

		Val	= localStorage.getItem(Name);
	}

	return Val;
};

VLCookieManager.prototype.WriteInternal = function(Name, Value, Timeout, TimeoutType, CookieModeOnly){

	var	cDate	= this.CreateTimeoutDate(Timeout, TimeoutType);
	var	cValue	= cDate.getTime();
	var	_Domain	= this.Owner.URI.authority.split(":")[0];
	var	Medium	= (!CookieModeOnly && this.Owner.UseLocalStorage && this.LocalStorageAvailable) ? "LS" : "C";

	if(_CookieDomain && _CookieDomain != null){

		_Domain	= _CookieDomain;
	}
	else{

		if(this.Owner.ParameterExists("OM.domain")){

			_Domain	= PrepDecoded(this.Owner.Parameters["OM.domain"]).split(":")[0];
		}
	}

	if(Medium == "C"){

		document.cookie	= Name + "=" + Value + "; expires=" + cDate.toGMTString() + "; path=/; domain=" + ((_Domain == "localhost") ? ";" : _Domain);
	}
	else{

		localStorage.setItem(Name, Value);
	}
};

VLCookieManager.prototype.CreateTimeoutDate = function(Timeout, TimeoutType){

	var	tDate = new Date();

	if(Timeout < 0){

		tDate.setTime(tDate.getTime() - (1 * 60 * 1000));
	}
	else{

		if(TimeoutType == "D" || TimeoutType == "DAY"){

			tDate.setTime(tDate.getTime() + (Timeout * 24 * 60 * 60 * 1000));
		}
		else{

			tDate.setTime(tDate.getTime() + (Timeout * 60 * 1000));
		}
	}

	return tDate;
};

VLCookieManager.prototype.ToLongDateString = function(_Date){

	var	_Month, _Day, _Hour, _Minute, _Second;

	if(_Date.getMonth() + 1 < 10){

		_Month = "0"+ (_Date.getMonth() + 1);
	}
	else{

		_Month = (_Date.getMonth() + 1);
	}

	if(_Date.getDate() < 10){

		_Day = "0"+ _Date.getDate();
	}
	else{

		_Day = _Date.getDate();
	}

	if(_Date.getHours() < 10){

		_Hour = "0"+ _Date.getHours();
	}
	else{

		_Hour = _Date.getHours();
	}

	if(_Date.getMinutes() < 10){

		_Minute	= "0"+ _Date.getMinutes();
	}
	else{

		_Minute	= _Date.getMinutes();
	}

	if(_Date.getSeconds() < 10){

		_Second	= "0"+ _Date.getSeconds();
	}
	else{

		_Second	= _Date.getSeconds();
	}

	return _Date.getFullYear() +"-"+ _Month +"-"+ _Day +" "+ _Hour +":"+ _Minute +":"+ _Second;
};

VLCookieManager.prototype.ToLongDate = function(SDate){

	var	Arr	 = SDate.split(" ");
	var	DArr = Arr[0].split("-");
	var	TArr = Arr[1].split(":");

	return new Date(Number(DArr[0]), Number(DArr[1])-1, Number(DArr[2]), Number(TArr[0]), Number(TArr[1]), Number(TArr[2]));
};

VLCookieManager.prototype.IsLocalStorageAvailable = function(){

	try
	{
		if(localStorage && localStorage != undefined){

			localStorage.setItem("VL_LS_Test", "VL_LS_Test");
			localStorage.removeItem("VL_LS_Test");

			return true;
		}
		else{

			return false;
		}
	}
	catch(Ex)
	{
		return false;
	}
};

function VLCookieManagerVault(){

	this.Items = new Array();
}

function VLCookieManagerVaultItem(Key, Value, ExpireDate){

	this.K	= Key;
	this.V	= Value;
	this.E	= ExpireDate;
}

var	_VTObjs		= new Object();
var	_VTObjIDs	= 0;

VisilabsTarget.prototype.ID							= null;
VisilabsTarget.prototype.Owner						= null;
VisilabsTarget.prototype.ContentID					= null;
VisilabsTarget.prototype.Parameters					= new Object();
VisilabsTarget.prototype.OnCallback					= null;
VisilabsTarget.prototype.TVisitCookieName			= "VLTVisitC";
VisilabsTarget.prototype.TVisitorCookieName			= "VLTVisitorC";
VisilabsTarget.prototype.BannerVisitCookieName		= "VLTB_VisitC";
VisilabsTarget.prototype.BannerVisitorCookieName	= "VLTB_VisitorC";
VisilabsTarget.prototype.ABTestCookieName			= "VLTB_ABTestC";
VisilabsTarget.prototype.ABTestWidgetCookieName		= "VLTB_ABTestWC";
VisilabsTarget.prototype.ABTestWidgetCookieCount	= 100;
VisilabsTarget.prototype.OnErrorCallback			= null;
VisilabsTarget.prototype.RequestTimeout				= 2000;
VisilabsTarget.prototype.Completed					= false;
VisilabsTarget.prototype.CDBCookieName				= "VLT_CDB";

function VisilabsTarget(ContentID, Owner, OnCallback, OnErrorCallback){

	this.ID					= "_VisilabsTarget_"+ _VTObjIDs.toString();
	this.Owner				= Owner;
	this.ContentID			= ContentID;
	this.OnCallback			= OnCallback;
	this.OnErrorCallback	= OnErrorCallback;
	this.Parameters			= new Object();
	this.Completed			= false;
	this.RequestStartTime	= null;

	_VTObjs[this.ID]		= this;
	_VTObjIDs++;
}

VisilabsTarget.prototype.Collect = function(){

	this.CollectBoth("Target.js");
};

VisilabsTarget.prototype.CollectActions = function(){

	this.CollectBoth("act.js");
};

VisilabsTarget.prototype.CollectBoth = function(JSName){

	this.Completed			= false;

	var	_this				= this;
	var	JS					= null;
	var	Dt					= new Date();
	var	Src					= this.Owner.RequestProtocol +"://"+ this.Owner.TargetURL + JSName +"?OM.cookieID=" + this.Owner.CookieID + "&OM.oid=" + this.Owner.OrganizationID + "&OM.siteID=" + this.Owner.SiteID + "&OM.obj=" + encodeURIComponent("_VTObjs[\"" + this.ID + "\"]") +"&dat="+ Dt.toUTCString();
	var	TVisitCookie		= this.Owner.GetCookie(this.TVisitCookieName);
	var	TVisitorCookie		= this.Owner.GetCookie(this.TVisitorCookieName);
	var	BVisitCookie		= this.Owner.GetCookie(this.BannerVisitCookieName);
	var	BVisitorCookie		= this.Owner.GetCookie(this.BannerVisitorCookieName);
	var	VABTestCookie		= this.Owner.GetCookie(this.ABTestCookieName);
	var	VABTestWidgetCookie	= this.Owner.GetCookie(this.ABTestWidgetCookieName);
	var	VCDBCookie			= this.Owner.GetCookie(this.CDBCookieName);

	this.Owner.WriteExVisitorID();

	for(var Key in this.Parameters){

		Src	+= "&"+ Key +"="+ this.Parameters[Key];
	}

	this.Owner.OnExVisitorIDChanged();
	this.Owner.WriteCookieParameters();
	this.Owner.TrackHandler("check");
	for(var Key in this.Owner.Parameters){

		if(this.Parameters[Key] == typeof(undefined) || this.Parameters[Key] == null || this.Parameters[Key] == ""){

			Src	+= "&"+ Key +"="+ this.Owner.Parameters[Key];
		}
	}

	if(TVisitCookie != null && TVisitCookie != ""){

		Src	+= "&OM.vcap="+ PrepEncoded(TVisitCookie);
	}

	if(TVisitorCookie != null && TVisitorCookie != ""){

		Src	+= "&OM.viscap="+ PrepEncoded(TVisitorCookie);
	}

	if(BVisitCookie != null && BVisitCookie != ""){

		Src	+= "&OM.bvcap="+ PrepEncoded(BVisitCookie);
	}

	if(BVisitorCookie != null && BVisitorCookie != ""){

		Src	+= "&OM.bviscap="+ PrepEncoded(BVisitorCookie);
	}

	if(VABTestCookie != null && VABTestCookie != ""){

		Src	+= "&OM.ab.ck="+ PrepEncoded(VABTestCookie);
	}

	if(VABTestWidgetCookie != null && VABTestWidgetCookie != ""){

		Src	+= "&OM.abw.ck="+ PrepEncoded(VABTestWidgetCookie);
	}

	if(VCDBCookie != null && VCDBCookie != ""){

		Src	+= "&OM.cd="+ PrepEncoded(VCDBCookie);
	}

	JS			= document.createElement("script");
	JS.type		= "text/javascript";
	JS.async	= true;
	JS.src		= Src;
	JS.onerror	= function(){_this.OnError();};

	document.getElementsByTagName("head")[0].appendChild(JS);

	if(this.OnErrorCallback && this.OnErrorCallback != null){

		setTimeout(function(){_this.CheckRequestTimeout();}, _this.RequestTimeout);
	}
};

VisilabsTarget.prototype.CheckRequestTimeout = function(){

	if(!this.Completed){

		if(this.OnErrorCallback && this.OnErrorCallback != null){

			this.Completed	= true;
			this.OnErrorCallback(2);
		}
	}
};

VisilabsTarget.prototype.OnError = function(){

	if(!this.Completed){

		if(this.OnErrorCallback && this.OnErrorCallback != null){

			this.Completed	= true;
			this.OnErrorCallback(1);
		}
	}
};

VisilabsTarget.prototype.AddParameter = function(Name, Value){

	this.Parameters[Name] = PrepEncoded(Value);
};

VisilabsTarget.prototype.SetABTestWidgetCookie = function(ABTestWidgetCookie){

	if(ABTestWidgetCookie && ABTestWidgetCookie != null && ABTestWidgetCookie != ""){

		var	Vals	= this.Owner.GetCookie(this.ABTestWidgetCookieName);
		var	List	= null;
		var	Found	= false;

		if(Vals != null && Vals != ""){

			List = PrepDecoded(Vals).split(";");

			for(var i=0; i<List.length; i++){

				if(List[i] == ABTestWidgetCookie){

					Found = true;
					break;
				}
			}

			if(!Found){

				if(List.length > this.ABTestWidgetCookieCount){

					while(List.length > this.ABTestWidgetCookieCount){

						List.splice(0, 1);
					}
				}

				List.push(ABTestWidgetCookie);
			}

			Vals = null;

			for(var i=0; i<List.length; i++){

				if(Vals == null){

					Vals = List[i];
				}
				else{

					Vals += ";"+ List[i];
				}
			}
		}
		else{

			Vals = ABTestWidgetCookie;
		}

		this.Owner.SetCookie(this.ABTestWidgetCookieName, PrepEncoded(Vals), this.Owner.NewCookieTimeout, "DAY");
	}
};

VisilabsTarget.prototype.SetBannerCookie = function(CookieName, CurrentValue, Timeout, TimeoutType){

	if(CurrentValue != null && CurrentValue != ""){

		var	TArr			= null;
		var	BArr			= null;
		var	ZoneID			= null;
		var	BannerID		= null;
		var	CappingCount	= null;
		var	BannerItems		= null;
		var	Items			= CurrentValue.split(";");

		for(var i=0; i<Items.length; i++){

			TArr = Items[i].split("#");

			if(TArr.length > 1){

				ZoneID		= TArr[0];
				BannerItems	= TArr[1].split("~");

				for(var j=0; j<BannerItems.length; j++){

					BArr = BannerItems[j].split("|");

					if(BArr.length > 1){

						BannerID	 = BArr[0];
						CappingCount = BArr[1];

						if(ZoneID == this.Parameters["OM.zid"]){

							this.SetBannerCookieP2(CookieName, ZoneID, BannerID, CappingCount, Timeout, TimeoutType);
						}
					}
				}
			}
		}
	}
};

VisilabsTarget.prototype.SetBannerCookieP2 = function(CookieName, ZoneID, BannerID, CappingCount, Timeout, TimeoutType){

	var	CookieCappingCount	= null;
	var	CookieBannerID		= null;
	var	CookieZoneID		= null;
	var	BannerItems			= null;
	var	TArr				= null;
	var	CookieValue			= PrepDecoded(this.Owner.GetCookie(CookieName));
	var	Items				= (CookieValue != null && CookieValue != "null") ? CookieValue.split(";") : new Array();
	var	ZoneFound			= false;
	var	BannerFound			= false;
	var	FinalValue			= null;

	for(var i=0; i<Items.length; i++){

		TArr = Items[i].split("#");

		if(TArr.length > 1){

			CookieZoneID	= TArr[0];
			BannerItems		= TArr[1].split("~");

			if(CookieZoneID == ZoneID){

				for(var j=0; j<BannerItems.length; j++){

					BArr = BannerItems[j].split("|");

					if(BArr.length > 1){

						CookieBannerID		= BArr[0];
						CookieCappingCount	= BArr[1];

						if(CookieBannerID == BannerID){

							BannerItems[j]	= BannerID +"|"+ CappingCount;
							BannerFound		= true;

							break;
						}
					}
				}

				if(!BannerFound){

					TArr[1] += ((TArr[1] != "") ? "~": "") + BannerID +"|"+ CappingCount;
					Items[i] = TArr.join("#");
				}
				else{

					TArr[1]  = BannerItems.join("~");
					Items[i] = TArr.join("#");
				}

				ZoneFound = true;
				break;
			}
		}
	}

	if(!ZoneFound){

		Items.push(ZoneID +"#"+ BannerID +"|"+ CappingCount)
	}

	if(Items != null){

		FinalValue = Items.join(";");
		this.Owner.SetCookie(CookieName, PrepEncoded(FinalValue), Timeout, TimeoutType);
	}
};

VisilabsTarget.prototype.SendImpressionRequest = function(ActType, ActID){

	var	Dt	= new Date();
	var	Img	= new Image();
	var	Src	= null;

	Src		= this.Owner.RequestProtocol + "://" + "[DOMAIN]" + this.Owner.DataSource + "/om.gif?OM.siteID=" + this.Owner.SiteID + "&OM.oid="+ this.Owner.OrganizationID +"&OM.cookieID=VisilabsTarget&OM.uri=/om_evt.gif&OM.zdn="+ ActType +"&OM.zcp="+ ActID +"&OM.num1=1";
	Img.src	= Src.split("[DOMAIN]").join(this.Owner.SegmentURL) +"&dat="+ Dt.toUTCString();
};

VisilabsTarget.prototype.Callback = function(Result, TVisitCookie, TVisitorCookie, BVisitCookie, BVisitorCookie, ABTestCookie, ABTestWidgetCookie){

	if(!this.Completed){

		this.Completed	= true;

		if(TVisitCookie && TVisitCookie != null && TVisitCookie != ""){

			this.Owner.SetCookie(this.TVisitCookieName, PrepEncoded(TVisitCookie), this.Owner.VisitTimeout, "M");
		}

		if(TVisitorCookie && TVisitorCookie != null && TVisitorCookie != ""){

			this.Owner.SetCookie(this.TVisitorCookieName, PrepEncoded(TVisitorCookie), this.Owner.NewCookieTimeout, "DAY");
		}

		this.SetBannerCookie(this.BannerVisitCookieName, BVisitCookie, this.Owner.VisitTimeout, "M");
		this.SetBannerCookie(this.BannerVisitorCookieName, BVisitorCookie, this.Owner.NewCookieTimeout, "DAY");

		if(ABTestCookie && ABTestCookie != null && ABTestCookie != ""){

			this.Owner.SetCookie(this.ABTestCookieName, PrepEncoded(ABTestCookie), this.Owner.NewCookieTimeout, "DAY");
		}

		this.SetABTestWidgetCookie(ABTestWidgetCookie);

		if((typeof(Result)).toString() == "string"){

			if(this.ContentID != null && this.ContentID != ""){

				if(Result == null ||Result == ""){

					document.getElementById(this.ContentID).style.display	= "none";
				}
				else{

					document.getElementById(this.ContentID).style.display	= "";
					document.getElementById(this.ContentID).innerHTML		= Result;
				}
			}

			if(this.OnCallback && this.OnCallback != null){

				this.OnCallback(Result);
			}
		}
		else{

			if(this.OnCallback && this.OnCallback != null){

				this.OnCallback(Result);
			}
			else{

				for(var i=0; i<Result.length; i++){

					switch(Result[i].actiontype)
					{
						case "ExitIntent":
						{
							var	Sender	= this;
							var	ActID	= "act-"+ Result[i].actid;
							var	Item	= Result[i].actiondata;

							if (Item.waiting_time != undefined && Item.waiting_time > 0) {

								setTimeout(function () { bioEp.init({ width: Item.width, height: Item.height, html: Item.html, contentMinimized: Item.contentminimized, pos: Item.pos, cookieExp: 0, OnDisplay: function () { Sender.SendImpressionRequest("acttype-10", ActID); } }); }, Item.waiting_time * 1000);
							}
							else{

								bioEp.init({ width: Item.width, height: Item.height, html: Item.html, contentMinimized: Item.contentminimized, pos: Item.pos, cookieExp: 0, OnDisplay: function () { Sender.SendImpressionRequest("acttype-10", ActID); } });
							}

							break;
						}
						case "Redirect":
						{
							window.location.href = Result[i].actiondata.dest_url;
							break;
						}
						case "Javascript":
						{
							EvalString(Result[i].actiondata.jcode);
							break;
						}
						case "ShowHideDiv":
						{
							document.getElementById(Result[i].actiondata.id).style.display = Result[i].actiondata.display;
							break;
						}
						case "Popup":
						{
							return;
						}
						case "LightBox":
						{
							var	Item = Result[i].actiondata;
							var LB_actid = Result[i].actid;
							var Sender = this;

							switch(Result[i].actiondata.type)
							{
								case "Inline":
								{
									if(Result[i].actiondata.waiting_time != undefined && Result[i].actiondata.waiting_time > 0){

										setTimeout(function(){visi_lightbox({source:"html", content:Item.dest_url, style:"height:"+ Item.height +"px;width:"+ Item.width +"px;border:solid 1px white;"});Sender.SendImpressionRequest("acttype-5","act-"+LB_actid);}, Item.waiting_time * 1000);
									}
									else{

										visi_lightbox({source:"html", content:Result[i].actiondata.dest_url, style:"height:"+ Result[i].actiondata.height +"px;width:"+ Result[i].actiondata.width +"px;border:solid 1px white;"});
									}

									break;
								}
								case "URL":
								{
									if(Result[i].actiondata.waiting_time != undefined && Result[i].actiondata.waiting_time > 0){

										setTimeout(function(){visi_lightbox({source:"url", content:Item.dest_url, width:Item.width, height:Item.height, style:"default"});Sender.SendImpressionRequest("acttype-5","act-"+LB_actid);}, Item.waiting_time * 1000);
									}
									else{

										visi_lightbox({source:"url", content:Result[i].actiondata.dest_url, width:Result[i].actiondata.width, height:Result[i].actiondata.height, style:"default"});
									}

									break;
								}
							}

							break;
						}
						case "SendPromoCode":
						{
							visi_lightbox({source:"html", content:Result[i].actiondata.html, style:"height:"+ Result[i].actiondata.height +"px;width:"+ Result[i].actiondata.width +"px;border:solid 1px white;"});
							break;
						}
						case "Notifier":
						case "ProductStatNotifier":
						{
							var BoxStyle = "Style1";
							var CloseButton = false;
							var CloseSRC = "";
							var timeout = 0;
							var pagePosition = "bottomRight";
							var SenderNP = this;


							if (Result[i].actiondata.boxstyle) {

								BoxStyle = Result[i].actiondata.boxstyle;
							}

							if (Result[i].actiondata.showclosebtn) {
								if (Result[i].actiondata.showclosebtn == true) {

									CloseButton = true;
									CloseSRC = Result[i].actiondata.closebtnimage;
								}
							}

							if (Result[i].actiondata.timeout && Number(Result[i].actiondata.timeout) > 0) {

								timeout = Number(Result[i].actiondata.timeout);
							}

							if (Result[i].actiondata.pos && Result[i].actiondata.pos != "") {

								pagePosition = Result[i].actiondata.pos;
							}

							if (BoxStyle == "Style1") {

								var Width = 0;
								var Height = 0;

								if (Result[i].actiondata.width && Result[i].actiondata.width != "") {

									Width = Number(Result[i].actiondata.width);
								}

								if (Result[i].actiondata.height && Result[i].actiondata.height != "") {

									Height = Number(Result[i].actiondata.height);
								}

								if (Result[i].actiondata.waiting_time != undefined && Result[i].actiondata.waiting_time > 0) {
									var BgColor = Result[i].actiondata.bgcolor;
									var Content = Result[i].actiondata.content;
									var NotifierActID1 = Result[i].actid;
									setTimeout(function () { ResetVisiNotifier(); visi_notifier.set({ delay: timeout, bgColor: BgColor, position: pagePosition, width: Width, height: Height, showCloseBtn: CloseButton, closeBtnImage: CloseSRC }); visi_notifier.log(Content); SenderNP.SendImpressionRequest("acttype-12","act-"+NotifierActID1);}, Result[i].actiondata.waiting_time * 1000);
								}
								else {

									ResetVisiNotifier();
									visi_notifier.set({ delay: timeout, bgColor: Result[i].actiondata.bgcolor, position: pagePosition, width: Width, height: Height, showCloseBtn: CloseButton, closeBtnImage: CloseSRC });
									visi_notifier.log(Result[i].actiondata.content);
								}
							}
							else if (BoxStyle == "Style2") {

								var _this = this.Owner;

								if (Result[i].actiondata.waiting_time != undefined && Result[i].actiondata.waiting_time > 0) {
									var vlcontent = Result[i].actiondata.content;
									var vlcontentminimized = Result[i].actiondata.contentminimized;
									var NotifierActID2 = Result[i].actid;
									setTimeout(function () { LoadVisiNotifierStyle2(NotifierActID2, vlcontent, vlcontentminimized, _this, CloseButton, CloseSRC, pagePosition, timeout); SenderNP.SendImpressionRequest("acttype-12","act-"+NotifierActID2); }, Result[i].actiondata.waiting_time * 1000);
								}
								else {

									LoadVisiNotifierStyle2(Result[i].actid, Result[i].actiondata.content, Result[i].actiondata.contentminimized, _this, CloseButton, CloseSRC, pagePosition, timeout);
								}
							}

							break;
						}
						case "ShowBanner":
						{
							if(Result[i].actiondata.dest_url != null && Result[i].actiondata.dest_url != ""){

								visi_lightbox({source:"html", content:"<a style=\"border:0px; cursor:pointer;\" href=\""+ Result[i].actiondata.dest_url +"\"><img src=\""+ Result[i].actiondata.img_url +"\" /></a>", width:Result[i].actiondata.width, height:Result[i].actiondata.height, style:"default"});
							}
							else{

								visi_lightbox({source:"html", content:"<img src=\""+ Result[i].actiondata.img_url +"\" />", width:Result[i].actiondata.width, height:Result[i].actiondata.height, style:"default"});
							}

							break;
						}
						case "ShowProductWidget":
						{
							var	MasterTemplate			= "";
							var	DiscountHTMLTemplate	= "";
							var	ItemTemplate			= "";
							var	Item					= "";
							var	ItemContents			= ""
							var	FinalContent			= "";
							var	BodyAppender			= null;
							var	Value					= null;
							var	GUID					= this.Owner.GenerateGUID();
							var	Products				= null;
							var	SalePrice				= "";
							var	DiscountedPrice			= "";
							var	ItemDiscountTemplate	= "";
							var	Node					= null;
							var	ItemSeperatorTemplate	= null;

							if(Result[i].actiondata.template && Result[i].actiondata.template != null && Result[i].actiondata.template.MasterHTMLTemplate && Result[i].actiondata.template.MasterHTMLTemplate != null){

								MasterTemplate			= Result[i].actiondata.template.MasterHTMLTemplate;
								DiscountHTMLTemplate	= Result[i].actiondata.template.DiscountHTMLTemplate;

								if(Result[i].actiondata.template && Result[i].actiondata.template != null && Result[i].actiondata.template.ItemHTMLTemplate && Result[i].actiondata.template.ItemHTMLTemplate != null){

									ItemTemplate			= Result[i].actiondata.template.ItemHTMLTemplate;
									ItemSeperatorTemplate	= Result[i].actiondata.template.SeperatorHTMLTemplate;

									if(Result[i].actiondata.data && Result[i].actiondata.data != null){

										Products = EvalString(Result[i].actiondata.data);

										if(Products != null && Products.length > 0){

											for(var t=0; t<Products.length; t++){

												Item					= ItemTemplate;
												ItemDiscountTemplate	= DiscountHTMLTemplate;
												SalePrice				= "";
												DiscountedPrice			= "";

												if(Products[t].discount && Products[t].discount != null && Products[t].discount != "" && Number(Products[t].discount) > 0){

													SalePrice				= Products[t].dprice + ((Products[t].dcur && Products[t].dcur != "") ? (" "+ Products[t].dcur) : "");
													DiscountedPrice			= Products[t].price + ((Products[t].cur && Products[t].cur != "") ? (" "+ Products[t].cur) : "");
													ItemDiscountTemplate	= ItemDiscountTemplate.split("<%Price%>").join(DiscountedPrice);
												}
												else{

													SalePrice				= Products[t].price + ((Products[t].cur && Products[t].cur != "") ? (" "+ Products[t].cur) : "");
													ItemDiscountTemplate	= "";

												}

												Item	= Item.split("<%GUID%>").join(GUID);
												Item	= Item.split("<%INDEX%>").join(t);
												Item	= Item.split("<%SalePrice%>").join(SalePrice);
												Item	= Item.split("<%Discounted%>").join(ItemDiscountTemplate);

												for(var Key in Products[t]){

													Value = Products[t][Key];
													Item  = Item.split("<%"+ Key +"%>").join(Value);
												}

												if(ItemSeperatorTemplate != null && ItemSeperatorTemplate != "" && t != Products.length-1){

													Item += ItemSeperatorTemplate
												}

												ItemContents += Item;
											}
										}
									}

									MasterTemplate = MasterTemplate.replace("<%ItemTemplate%>", ItemContents);
								}

								FinalContent = MasterTemplate;
								FinalContent = FinalContent.split("<%GUID%>").join(GUID);
							}

							if(this.ContentID && this.ContentID != null){

								document.getElementById(this.ContentID).innerHTML = FinalContent;
							}
							else{

								if(Result[i].actiondata.dsp == "LightBox"){

									if(Result[i].actiondata.width > 0 && Result[i].actiondata.height > 0){

										visi_lightbox({source:"html", content:FinalContent, style:"height:"+ Result[i].actiondata.height +"px;width:"+ Result[i].actiondata.width +"px;border:solid 1px white;"});
									}
									else{

										visi_lightbox({source:"html", content:FinalContent, style:"border:solid 1px white;"});
									}
								}
								else if(Result[i].actiondata.dsp == "Inline"){

									if(Result[i].actiondata.deid.substring(0,1) == "."){

										Node = document.querySelector(Result[i].actiondata.deid);
									}
									else{

										Node = document.getElementById(Result[i].actiondata.deid);
									}

									if(Node && Node != null && Node.parentNode && Node.parentNode != null){

										BodyAppender			= document.createElement("span");
										BodyAppender.innerHTML	= FinalContent;

										if(Result[i].actiondata.after){

											Node.parentNode.insertBefore(BodyAppender, Node.nextSibling);
										}
										else{

											Node.appendChild(BodyAppender);
										}
									}
								}
								else{

									if(document && document.body){

										BodyAppender			= document.createElement("span");
										BodyAppender.innerHTML	= FinalContent;

										document.body.appendChild(BodyAppender);
									}
								}
							}

							if(Result[i].actiondata.Javascript && Result[i].actiondata.Javascript != null){

								Result[i].actiondata.Javascript = Result[i].actiondata.Javascript.replace("<%GUID%>", GUID);
								EvalString(Result[i].actiondata.Javascript);
							}

							break;
						}
						case "SetHTML":
						{
							if(document.getElementById(Result[i].actiondata.deid) && document.getElementById(Result[i].actiondata.deid) != null)
							{
								document.getElementById(Result[i].actiondata.deid).innerHTML = Result[i].actiondata.html;
							}

							break;
						}
						case "SearchBox":
						{
							if(document.getElementById(Result[i].actiondata.deid)){

								if(Result[i].actiondata.type == "Value"){

									document.getElementById(Result[i].actiondata.deid).value = Result[i].actiondata.value;
									document.getElementById(Result[i].actiondata.deid).setAttribute("VLMask", Result[i].actiondata.value);

									if(window.attachEvent){

										document.getElementById(Result[i].actiondata.deid).attachEvent("onfocus", VL_ClearMask);
										document.getElementById(Result[i].actiondata.deid).attachEvent("onblur", VL_ApplyMask);
									}
									else{

										document.getElementById(Result[i].actiondata.deid).addEventListener("focus", VL_ClearMask, false);
										document.getElementById(Result[i].actiondata.deid).addEventListener("blur", VL_ApplyMask, false);
									}
								}
								else{

									document.getElementById(Result[i].actiondata.deid).setAttribute("placeholder", Result[i].actiondata.value);
								}
							}

							break;
						}
						case "CountDownBox":
						{
							var DTA			= Result[i].actiondata.value.split(" ");
							var	DT			= DTA[0].split("-");
							var	TM			= DTA[1].split(":");
							var	ExpireDate	= new Date(Number(DT[0]), Number(DT[1]-1), Number(DT[2]), Number(TM[0]), Number(TM[1]), Number(TM[2]));
							var	Sender		= this.Owner;

							LoadVisiCountDown(Result[i].actid, Result[i].actiondata.content, Result[i].actiondata.contentminimized, Sender, Result[i].actiondata.pos, Result[i].actiondata.bgcolortop, Result[i].actiondata.bgcolorbottom, ExpireDate);
							this.CountDownBoxCookie(Result[i].actiondata.trckcountdown);

							break;
						}
						case "MailSubscriptionForm":
						{
                            var SenderMS = this;
							switch (Result[i].actiondata.style.toLowerCase()) {

								case "lightbox":
								{
									var LItem = Result[i].actiondata;
									var LActID = Result[i].actid;

									if (Result[i].actiondata.waiting_time != undefined && Result[i].actiondata.waiting_time > 0) {
										setTimeout(function () { visi_lightbox({
											source: "mail_subscription_form",
											style: "height:" + LItem.height + "px;width:" + LItem.width + "px;border:solid 1px white;",
											actid: LActID, auth: LItem.auth,
											container_style: LItem.container_style,
											title_style: LItem.title_style,
											title: LItem.title,
											message_style: LItem.message_style,
											message: LItem.message,
											placeholder: LItem.placeholder,
											input_style: LItem.input_style,
											button_style: LItem.button_style,
											button_label: LItem.button_label });  SenderMS.SendImpressionRequest("acttype-26", "act-" + LActID);}, LItem.waiting_time * 1000);
									}
									else {
										visi_lightbox({
											source: "mail_subscription_form",
											style: "height:" + Result[i].actiondata.height + "px;width:" + Result[i].actiondata.width + "px;border:solid 1px white;",
											actid: Result[i].actid,
											auth: Result[i].actiondata.auth,
											container_style: Result[i].actiondata.container_style,
											title_style: Result[i].actiondata.title_style,
											title: Result[i].actiondata.title,
											message_style: Result[i].actiondata.message_style,
											message: Result[i].actiondata.message,
											placeholder: Result[i].actiondata.placeholder,
											input_style: Result[i].actiondata.input_style,
											button_style: Result[i].actiondata.button_style,
											button_label: Result[i].actiondata.button_label
										});
									}

									break;
								}
								case "exitintent":
								{
									var EActID = Result[i].actid;
									var EItem = Result[i].actiondata;

									if (Result[i].actiondata.waiting_time != undefined && Result[i].actiondata.waiting_time > 0) {

										setTimeout(function () { bioEp.init({
											width: EItem.width,
											height: EItem.height,
											cookieExp: 0,
											auth: EItem.auth,
											container_style: EItem.container_style,
											title_style: EItem.title_style,
											title: EItem.title,
											message_style: EItem.message_style,
											message: EItem.message,
											placeholder: EItem.placeholder,
											input_style: EItem.input_style,
											button_style: EItem.button_style,
											button_label: EItem.button_label,
											mail_subscription_form: true,
											actid: EActID,
											OnDisplay: function () { SenderMS.SendImpressionRequest("acttype-26", "act-" + EActID); }});}, EItem.waiting_time * 1000);
									}
									else {

										bioEp.init({
											width: Result[i].actiondata.width,
											height: Result[i].actiondata.height,
											cookieExp: 0,
											auth: Result[i].actiondata.auth,
											container_style: Result[i].actiondata.container_style,
											title_style: Result[i].actiondata.title_style,
											title: Result[i].actiondata.title,
											message_style: Result[i].actiondata.message_style,
											message: Result[i].actiondata.message,
											placeholder: Result[i].actiondata.placeholder,
											input_style: Result[i].actiondata.input_style,
											button_style: Result[i].actiondata.button_style,
											button_label: Result[i].actiondata.button_label,
											mail_subscription_form: true,
											actid: EActID,
											OnDisplay: function () { SenderMS.SendImpressionRequest("acttype-26", "act-" + EActID); }});
									}

									break;
								}
							}

							break;
						}
					}
				}
			}
		}
	}
};

VisilabsTarget.prototype.CountDownBoxCookie = function(Data){

	if(Data && Data != undefined && Data != null && Data != ""){

		var	Content	= "";
		var	CDB		= null;
		var	JSN		= null;
		var	Found	= false;

		JSN = this.Owner.CookieManager.Get(this.CDBCookieName);

		if(JSN != null && JSN != ""){

			CDB	= eval(JSN);

			for(var i=0; i<CDB.length; i++){

				if(CDB[i].oldid == Data.oldid){

					Found = true;
					break;
				}
			}

			if(!Found){

				CDB.push(Data);
				Content	= JSON.stringify(CDB);

				this.Owner.SetCookie(this.CDBCookieName, PrepEncoded(Content), this.Owner.NewCookieTimeout, "DAY");
			}
		}
		else{

			CDB = new Array();

			CDB.push(Data);
			Content	= JSON.stringify(CDB);

			this.Owner.SetCookie(this.CDBCookieName, PrepEncoded(Content), this.Owner.NewCookieTimeout, "DAY");
		}
	}
};

function VL_ClearMask(e){

	var	hWnd = (e && e.target) ? e.target : event.srcElement;

	if(hWnd.attributes["VLMask"] != undefined && hWnd.attributes["VLMask"] != null){

		if(hWnd.value == hWnd.attributes["VLMask"].value){

			hWnd.value = "";
		}
	}
}

function VL_ApplyMask(e){

	var	hWnd = (e && e.target) ? e.target : event.srcElement;

	if(hWnd.attributes["VLMask"] != undefined && hWnd.attributes["VLMask"] != null){

		if(hWnd.value.split(" ").join("") == ""){

			hWnd.value = hWnd.attributes["VLMask"].value;
		}
	}
}

function parseUri (str) {
	var	o   = parseUri.options,
		m   = o.parser[o.strictMode ? "strict" : "loose"].exec(str),
		uri = {},
		i   = 14;

	while (i--) uri[o.key[i]] = m[i] || "";

	uri[o.q.name] = {};

	if(uri[o.key[12]][0] == "&"){

		uri[o.key[12]] = uri[o.key[12]].substring(1, uri[o.key[12]].length);
	}

	uri[o.key[12]].replace(o.q.parser, function ($0, $1, $2) {
		if ($1) uri[o.q.name][$1] = $2;
	});

	return uri;
};

parseUri.options = {
	strictMode: false,
	key: ["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],
	q:   {
		name:   "queryKey",
		parser: /(?:^|&)([^&=]*)=?([^&]*)/g
	},
	parser: {
		strict: /^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,
		loose:  /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/
	}
};

function PrepEncoded(S){

	var	_S	= S;

	try
	{
		_S	= decodeURIComponent(_S);
	}
	catch(Ex){}

	return encodeURIComponent(_S);
}

function PrepDecoded(S){

	var	_S	= S;

	try
	{
		_S	= decodeURIComponent(_S);
	}
	catch(Ex){}

	return _S;
}

function DetectFlash(){

	var hasFlash = false;
	try {
		var fo = new ActiveXObject('ShockwaveFlash.ShockwaveFlash');
		if(fo) hasFlash = true;
	}catch(e){
		if(navigator.mimeTypes ["application/x-shockwave-flash"] != undefined) hasFlash = true;
	}

	return hasFlash;
}

function getFlashVersion() {
	try {
		try {
			var axo = new ActiveXObject('ShockwaveFlash.ShockwaveFlash.6');
			try { axo.AllowScriptAccess = 'always'; }
			catch (e) { return '6.0.0'; }
		} catch (e) { }
		return new ActiveXObject('ShockwaveFlash.ShockwaveFlash').GetVariable('$version').replace(/\D+/g, '.').match(/^,?(.+),?$/)[1];
	} catch (e) {
		try {
			if (navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin) {
				return (navigator.plugins["Shockwave Flash 2.0"] || navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g, ".").match(/^,?(.+),?$/)[1];
			}
		} catch (e) { }
	}
	return null;
}

function DateFormat(){}

DateFormat.DDMMYYYY	= "DDMMYYYY";
DateFormat.MMDDYYYY	= "MMDDYYYY";
DateFormat.YYYYMMDD	= "YYYYMMDD";

function VL_CP(Name, CName, Count, ParameterName, Minutes, CollectDate, RelatedParameters, WriteDistinct){

	this.Name				= Name;
	this.Count				= Count;
	this.CName				= CName;
	this.ParameterName		= ParameterName;
	this.Minutes			= Minutes;
	this.CollectDate		= CollectDate;
	this.RelatedParameters	= RelatedParameters;
	this.WriteDistinct		= WriteDistinct;
}

function SEngine(Authority, QueryParamName){

	this.Authority		= Authority;
	this.QueryParamName	= QueryParamName;
}

function VL_OfferFilter(Name, Type, Value){

	this.Name	= Name;
	this.Type	= Type;
	this.Value	= Value;
}
function VL_OfferOperator(){}

function VL_OfferFilterType() {}

VL_OfferFilterType.Equals = "0";
VL_OfferFilterType.NotEquals = "1";
VL_OfferFilterType.Like = "2";
VL_OfferFilterType.Include = "2";
VL_OfferFilterType.NotLike = "3";
VL_OfferFilterType.Exclude	 = "3";
VL_OfferFilterType.GreaterThan = "4";
VL_OfferFilterType.LessThan = "5";
VL_OfferFilterType.GreaterOrEquals = "6";
VL_OfferFilterType.LessOrEquals = "7";

VL_OfferOperator.AND = "0";
VL_OfferOperator.OR = "1";

function FindParentByAttr(Sender, AttrName){

	try
	{
		var	_Item	= Sender;

		while(_Item.parentNode){

			if(_Item != typeof(undefined) && _Item.attributes[AttrName]){

				return _Item;
			}
			else{

				_Item	= _Item.parentNode;
			}
		}
	}
	catch(Ex){return null}

	return Sender;
}

window.bioEp = {
	bgEl: {},
	popupEl: {},
	contentMinimizedEl: {},
	closeBtnEl: {},
	shown: false,
	overflowDefault: "visible",
	transformDefault: "",

	width: 400,
	height: 220,
	html: "",
	contentMinimized: "",
	pos: "bottomRight",
	css: "",
	fonts: [],
	delay: 2,
	showOnDelay: false,
	cookieExp: 30,

	mail_subscription_form: false,
	auth: "",
	container_style: "",
	title_style: "",
	message_style: "",
	input_style: "",
	button_style: "",
	title: "",
	message: "",
	placeholder: "",
	button_label: "",
	actid: "",

	cookieManager: {
		create: function(name, value, days) {
			var expires = "";

			if(days) {
				var date = new Date();
				date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
				expires = "; expires=" + date.toGMTString();
			}

			document.cookie = name + "=" + value + expires + "; path=/";
		},

		get: function(name) {
			var nameEQ = name + "=";
			var ca = document.cookie.split(";");

			for(var i = 0; i < ca.length; i++) {
				var c = ca[i];
				while (c.charAt(0) == " ") c = c.substring(1, c.length);
				if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
			}

			return null;
		},

		erase: function(name) {
			this.create(name, "", -1);
		}
	},

	checkCookie: function() {
		if(this.cookieExp <= 0) {
			this.cookieManager.erase("bioep_shown");
			return false;
		}

		if(this.cookieManager.get("bioep_shown") == "true")
			return true;

		this.cookieManager.create("bioep_shown", "true", this.cookieExp);

		return false;
	},

	addCSS: function() {
		for(var i = 0; i < this.fonts.length; i++) {
			var font = document.createElement("link");
			font.href = this.fonts[i];
			font.type = "text/css";
			font.rel = "stylesheet";
			document.head.appendChild(font);
		}

		var css = document.createTextNode(
			"#bio_ep_bg {display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; opacity: 0.3; z-index: 10001;}" +
			"#bio_ep {display: none; position: fixed; width: " + this.width + "px; height: " + this.height + "px; left: 50%; top: 50%; transform: translateX(-50%) translateY(-50%); z-index: 10002;}" +
			"#bio_ep_close {position:absolute;top:2px;right:2px;cursor:pointer;opacity:0.7;}" +
			this.css
		);

		var style = document.createElement("style");
		style.type = "text/css";
		style.appendChild(css);

		document.head.appendChild(style);
		//document.head.insertBefore(style, document.getElementsByTagName("style")[0]);
	},

	addContentMinimized: function () {

		this.contentMinimizedEl = document.createElement("section");
		this.contentMinimizedEl.id = "VisiExitIntentMinimizedContent";
		this.contentMinimizedEl.style.display = "none";
		this.contentMinimizedEl.style.position = "fixed";
		this.contentMinimizedEl.style.zIndex = "9999";
		this.contentMinimizedEl.style.cursor = "pointer";
		if (this.pos == "topLeft") {
			this.contentMinimizedEl.style.top = "5px";
			this.contentMinimizedEl.style.left = "0px";
		}
		else if (this.pos == "topRight") {
			this.contentMinimizedEl.style.top = "5px";
			this.contentMinimizedEl.style.right = "0px";
		}
		else if (this.pos == "bottomLeft") {
			this.contentMinimizedEl.style.bottom = "16px";
			this.contentMinimizedEl.style.left = "0px";
		}
		else if (this.pos == "bottomRight") {
			this.contentMinimizedEl.style.bottom = "16px";
			this.contentMinimizedEl.style.right = "0px";
		}
		this.contentMinimizedEl.innerHTML = this.contentMinimized;
		document.body.appendChild(this.contentMinimizedEl);
	},

	addPopup: function() {

		this.bgEl = document.createElement("div");
		this.bgEl.id = "bio_ep_bg";
		document.body.appendChild(this.bgEl);

		if(document.getElementById("bio_ep"))
			this.popupEl = document.getElementById("bio_ep");
		else {
			this.popupEl = document.createElement("div");
			this.popupEl.id = "bio_ep";

			if (this.mail_subscription_form) {
				this.popupEl.innerHTML = '<div id="visilabs_mail_subscription_form_container'+this.actid+'" style="' + this.container_style + '">'
					+ '<div id="visilabs_mail_subscription_form_title" style="' + this.title_style + '">' + this.title + '</div>'
					+ '<div id="visilabs_mail_subscription_form_message" style="' + this.message_style + '">' + this.message + '</div>'
					+ '<input id="visilabs_mail_subscription_form_input'+this.actid+'" type="email" placeholder="' + this.placeholder + '" style="' + this.input_style + '">'
					+ '<span id="visilabs_mail_subscription_invalid-email-span" style="color:#b94a48;margin-top:5px;margin-bottom:10px;display:none;">Invalid e-mail address.</span>'
					+ '<button id="visilabs_mail_subscription_form_button'+this.actid+'" type="button" style="' + this.button_style + '">' + this.button_label + '</button>'
					+ '</div>';
			} else {
				this.popupEl.innerHTML = this.html;
			}

			document.body.appendChild(this.popupEl);
		}

		this.closeBtnEl = document.createElement("img");
		this.closeBtnEl.id = "bio_ep_close";
		this.closeBtnEl.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA/tJREFUeNqEVG1oW2UUfm9u7k1z89HU5TtiiW4Thpo4EzT+q7RiWf3XBn+0ds2fWJxzQ7aBFEbxAxWHq0OabhQrbcekUEqnFNaMgnUW29QfCitLi2hrVtKPZGvTmdwkPZ73zU0ZM9oDD/feN+c873NOzjkc+X9TIQSEWvkuIvLKs6Jx/3FehbAgDkqSdNBisVhVaPfQ0un073i+iLiL2EHAforMiGP19fUDQ0NDS6urq1lQbGtrqzA5ObkaCoW+FwShA/2eeEh9RTJXTU3NqcHBwSVKkM/n4Ub0Bly+chl6I71w/bvrcH/rPiOfnZ1Neb3eixhzRCnLv8yKdmZmZiZNA3r7euGo/wWwOKxgtpvhgM3M3p99/jno/qCbXba5uVkMBAJ9GHtIEbRnWp7nm8fHx+9SsrffPQFE4EBj0ILFaQXb4/YSXHbQmfSAofDasUbY3t6G5eXlHAo5hxyPPUz4VHNz8ygl+6LnIi0ytLwRhA8//gi0Rgn0NQaoNptApeHheKgDznefB8ITaA+1s/R7enp+xZiXyippUV+fmppKYgpgddqYgktfXYLyBRyqpZcE8ZJisQjzv8yDwWQElaiCWz/dgnQqnTcajSfRR6KEOrvdfpbW5Nq311igRhJBZ5Bg+OowI/30s0+gJdgChXwBYvMxcLocIIhq5vvOyRPMp66u7gptNapOcDqdNrVaTeJ37rD8eY4nclYmoY4Okstmydkz5wjGkB+npwkSk7W1NSJJWpKXCyQeX2QxtbW1tG+raM6cmrKhoYJSRXfxFl4guZxMotGbpQngOHJ74TZJJteIKIgEdkuueVkuieD5Ehc9S6VSaXrodLlKXpjMg+zfJNgSJF8PDJDpH6ZJIvEXCYffQsUyOX361N58WC1W9kwmk/fwkaPvIlrr4tJSJh6PQ5WoARWngjfb2tgfMDc3B+YDZjzjYHi4VNO+SB9oq7SshpFIBGRZ3nU4HO/jt748z96urq4Z6ny8vZ05Xvj8Ap0GsNtswBEOBLUAGlGEkZERiEajoNFo4OlDhyGTycDY2NifGNNAMy/3oQkXwHsrKyu59fV18Ho8jNRUXQ1qFQ86VCMhRCTVSzoQeDUY9Aa4icS0OzweDx1Bx6NzfBj/+m9QPiQSCXi1oQGUTYIKCagIt/f9pNsNExMTLP1wODyJZ/5K8ywijjY2Nl7d2NgoUOfR0VFoa22FlwMB8Pt80NTUxEqBW4fVt7Ozk5K9Um7oSqah28Ptdnf39/cv7OzsFOERKxQKtGZ/+Hy+LxVl0n4LllcG/QgO/Yt+v/8Z2rTYZxyWIh2LxRZwIfyMv/+GWFc2+L4bu0ysVVpBq5zRPssgHtA5qBT0jwADAKOeG2u13ga9AAAAAElFTkSuQmCC';
		this.popupEl.insertBefore(this.closeBtnEl, this.popupEl.firstChild);

		if (this.mail_subscription_form) {
			document.getElementById("visilabs_mail_subscription_form_input"+this.actid).onclick = function () {
				document.getElementById("visilabs_mail_subscription_invalid-email-span").style.display = "none";
			};
			document.getElementById("visilabs_mail_subscription_form_button"+this.actid).onclick = function () {
				var email = document.getElementById("visilabs_mail_subscription_form_input"+window.bioEp.actid).value;
				if (visiValidateEmail(email)) {
					(new Visilabs()).SubscriptionWorker(window.bioEp.actid, window.bioEp.auth, email, true);
				} else {
					document.getElementById("visilabs_mail_subscription_invalid-email-span").style.display = "block";
				}
			};
		}

	},

	showPopup: function() {
		if(this.shown) return;

		this.bgEl.style.display = "block";
		this.popupEl.style.display = "block";

		this.scalePopup();

		this.overflowDefault = document.body.style.overflow;
		document.body.style.overflow = "hidden";

		this.shown = true;

		if(this.OnDisplay && this.OnDisplay != null){

			this.OnDisplay();
		}
	},

	hideContentMinimized: function () {
		//this.contentMinimizedEl.style.display = "none";
		this.contentMinimizedEl.parentNode.removeChild(this.contentMinimizedEl);
	},

	hidePopup: function() {
		this.bgEl.style.display = "none";
		this.popupEl.style.display = "none";

		document.body.style.overflow = this.overflowDefault;

		if (document.getElementById('VisiExitIntentMinimizedContent')) {
			document.getElementById('VisiExitIntentMinimizedContent').style.display = "block";
		}
	},

	scalePopup: function() {
		var margins = { width: 40, height: 40 };
		var popupSize = { width: bioEp.popupEl.offsetWidth, height: bioEp.popupEl.offsetHeight };
		var windowSize = { width: window.innerWidth, height: window.innerHeight };
		var newSize = { width: 0, height: 0 };
		var aspectRatio = popupSize.width / popupSize.height;

		if(popupSize.width > (windowSize.width - margins.width)) {
			newSize.width = windowSize.width - margins.width;
			newSize.height = newSize.width / aspectRatio;

			if(newSize.height > (windowSize.height - margins.height)) {
				newSize.height = windowSize.height - margins.height;
				newSize.width = newSize.height * aspectRatio;
			}
		}

		if(newSize.height === 0) {
			if(popupSize.height > (windowSize.height - margins.height)) {
				newSize.height = windowSize.height - margins.height;
				newSize.width = newSize.height * aspectRatio;
			}
		}

		var scaleTo = newSize.width / popupSize.width;

		if(scaleTo <= 0 || scaleTo > 1) scaleTo = 1;

		if(this.transformDefault === "")
			this.transformDefault = window.getComputedStyle(this.popupEl, null).getPropertyValue("transform");

		this.popupEl.style.transform = this.transformDefault + " scale(" + scaleTo + ")";
	},

	loadEvents: function() {
		document.addEventListener("mousemove", function(e) {
			var scroll = window.pageYOffset || document.documentElement.scrollTop;

			if((e.pageY - scroll) < 7)
				bioEp.showPopup();
		});

		this.closeBtnEl.addEventListener("click", function() {
			bioEp.hidePopup();
		});
		this.closeBtnEl.addEventListener('mouseover', function () { this.style.opacity = "1"; });
		this.closeBtnEl.addEventListener('mouseout', function () { this.style.opacity = '0.7'; });

		window.addEventListener("resize", function() {
			bioEp.scalePopup();
		});

		this.bgEl.addEventListener("click", function () { bioEp.hidePopup(); }, false);

		if (document.getElementById('VisiExitIntentMinimizedContent')) {
			this.contentMinimizedEl.addEventListener("click", function () {
				this.style.display = "none";
				bioEp.shown = false;
				bioEp.showPopup();
			});
		}

		if (document.getElementById('btnCloseVisiExitIntentMinimizedContent')) {
			document.getElementById('btnCloseVisiExitIntentMinimizedContent').addEventListener("click", function (e) {
				bioEp.hideContentMinimized();
				if (e.stopPropagation) {
					e.stopPropagation();
				} else {
					e.cancelBubble = true;
				}
			});
		}
	},

	setOptions: function(opts) {
		this.width = (typeof opts.width === 'undefined') ? this.width : opts.width;
		this.height = (typeof opts.height === 'undefined') ? this.height : opts.height;
		this.html = (typeof opts.html === 'undefined') ? this.html : opts.html;
		this.css = (typeof opts.css === 'undefined') ? this.css : opts.css;
		this.fonts = (typeof opts.fonts === 'undefined') ? this.fonts : opts.fonts;
		this.delay = (typeof opts.delay === 'undefined') ? this.delay : opts.delay;
		this.showOnDelay = (typeof opts.showOnDelay === 'undefined') ? this.showOnDelay : opts.showOnDelay;
		this.cookieExp = (typeof opts.cookieExp === 'undefined') ? this.cookieExp : opts.cookieExp;
		this.OnDisplay = opts.OnDisplay;
		this.contentMinimized = (typeof opts.contentMinimized === 'undefined') ? this.contentMinimized : opts.contentMinimized;
		this.pos = (typeof opts.pos === 'undefined') ? this.pos : opts.pos;

		this.mail_subscription_form = (typeof opts.mail_subscription_form === 'undefined') ? this.mail_subscription_form : opts.mail_subscription_form;
		this.auth = (typeof opts.auth === 'undefined') ? this.auth : opts.auth;
		this.container_style = (typeof opts.container_style === 'undefined') ? this.container_style : opts.container_style;
		this.title_style = (typeof opts.title_style === 'undefined') ? this.title_style : opts.title_style;
		this.message_style = (typeof opts.message_style === 'undefined') ? this.message_style : opts.message_style;
		this.input_style = (typeof opts.input_style === 'undefined') ? this.input_style : opts.input_style;
		this.button_style = (typeof opts.button_style === 'undefined') ? this.button_style : opts.button_style;
		this.title = (typeof opts.title === 'undefined') ? this.title : opts.title;
		this.message = (typeof opts.message === 'undefined') ? this.message : opts.message;
		this.placeholder = (typeof opts.placeholder === 'undefined') ? this.placeholder : opts.placeholder;
		this.button_label = (typeof opts.button_label === 'undefined') ? this.button_label : opts.button_label;
		this.actid = (typeof opts.actid === 'undefined') ? this.actid : opts.actid;

	},

	domReady: function(callback) {
		(document.readyState === "interactive" || document.readyState === "complete") ? callback() : document.addEventListener("DOMContentLoaded", callback);
	},

	init: function(opts) {
		this.domReady(function() {
			if(typeof opts !== 'undefined')
				bioEp.setOptions(opts);

			if (!this.mail_subscription_form && bioEp.contentMinimized != "")
				bioEp.addContentMinimized();

			if (!this.mail_subscription_form) {
				if (bioEp.checkCookie()) return;
			}

			bioEp.addCSS();

			bioEp.addPopup();

			setTimeout(function() {
				bioEp.loadEvents();

				if(bioEp.showOnDelay)
					bioEp.showPopup();
			}, bioEp.delay * 1000);
		});
	}
}

function InitLightBox() {

	if(document.body == null || typeof(document.body) == typeof(undefined)){

		setTimeout(InitLightBox, 500);
		return;
	}

	var overlay = document.createElement('div');
	overlay.style.display = 'none';
	var content_fixed = document.createElement('div');
	content_fixed.style.display = 'none';
	var popbox = document.createElement('div');
	var overlay_wrapper = document.createElement('div');
	overlay_wrapper.style.display = 'none';
	content_fixed.id = 'visi_lightbox_content_fixed';
	content_fixed.setAttribute('style', 'position:fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);-webkit-transform: translate(-50%, -50%);-ms-transform: translate(-50%, -50%);opacity:1; z-index:1000004');
	popbox.id = 'visi_lightbox_popbox';
	overlay_wrapper.id = "visi_lightbox_overlay_wrapper";
	overlay_wrapper.setAttribute('style', 'position:absolute;top:0;bottom:0;left:0;right:0;z-index:1000003;');
	overlay.id = "visi_lightbox_overlay";
	overlay.setAttribute('style', 'position:fixed;top:0;bottom:0;left:0;right:0;opacity:0.3;width:100%;height:100%;background-color:black;z-index:1000003;');
	overlay_wrapper.appendChild(overlay);
	content_fixed.appendChild(popbox);
	document.body.appendChild(overlay_wrapper);

	var closeBtn = document.createElement('img');
	closeBtn.id = 'img_lightbox_close';
	closeBtn.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB8ZJREFUeNqkVw1MVVUcP/e++z7ufe/Be4/3AQjIh4qYUippZC50kSD4gZabutYIyqRkWW3VpqwtZ7kox1RymrNERb4yneVMmxqobebCibIyFDNxoIISwgPee//+53Du5aFmaof9dnnn3nP+v/P/PgJ5+CFwiPypjgAC+POhNnuQQYVJCCNC5jDwOYEL7UN4ET382RdE6pEJUMF6hAVhR4QhXBwOk8mkCIIg9vf39/l8vls4dwNxjaMdcYuT8T0KAXo6M8KJiEaMSkhIGJ+WljYmNTU1OjEx0e7xeEw6nU7o6urqb25u7qqvr2+rq6trOnr06K99fX1ncE0zogXRiej9L20EDwM/5XjES2PHjv1q69atF9vb2+FBxqlTpzrz8/OPiqL4Pq6fjojlhxEfVHg4IhXV+y6OXzo6OgLBAi5cuAC1dXXwze5voKq6Cg79eAjONTaC19szhMiBAwfaYmNjN+JecxAjuSnvS4La24142mAwrNyyZUuzupnf74fqmmqYt2A+jH4sCWLih8Ow4VEM0XExMCopETKyMqB04xdw7do1jQSapnfSpEkVuOc8RAJC+TfT67ijpUiS9MG2bdv+VDc5e/YszHtxPjg8YeCK9EBUXDQjEAxKIjwqAsLCnTD56aegEjWjjra2Nl9KSko57p3F/clwLwKU2WhE/qpVq86pi3+q/QkSEkeAxW4FV4QbIqIj7ws3ErQ57WB1hMDHaz7WSDQ1NXldLtda3P8ZHk2ieurg04+eOnXqwk2bNk1F7ybnGs+R+QteIKhSglohZsVMOrs6mQIDgcBQQID0enuJ0WgkgL7uD/jJ4SNHiDPMSVImphC73S45HA7P3r17f0c5bYiu4PCkiWUMeu27Bw8evE4Ze71eSM98HkSjDpRQM2TMzIATJ04AEgLBIEKo0zYIlw1MVhncwzywa9cu2PzlZmYKOkfNdvLkSaYFzBcwYcKEHSgrjeaRYF+gp0+bMmVKFXU2Or7e9jWgksBgMTL7NqKX09He3gGz5s5i78w2CzONpOghzOOE7du3ayoveLMABL0ImE1gzrw54Ov3sfn169dTDbzMQ1OnZrsoxKLVq1c30I96e3sh9ZlU3EAAOUQGvayHZW8VAqqabYJhCdlzsmlSAR1qyOFywI4dOzThu7/dDU4kZDQbwWQxMfz88wn27vLly31Wq/UjXJvMUzsLvVGo/neOHTvWMeD1DaBYZDAqRlBQjbLZxIQVvFEAqoZu3rwJGZkZYLGahwinuUGxKCAZdGwtBV1b9GERe08PkZyc/BXOTeF5gbFIRgf55OrVqz71BGgdJlgxy4yMrNxNAr8H9Jmhws0oXK9ja9haBN1r5sxMTYOZmZn7cK90hE3iJjCgWiw4mE3+uvwXy9oCcB+h/+OfLJtI6YZSEvD7SXHxZyQ8PJyBjvLycpKfn0ewBhCD0TCkKIuCQFrb2gialmABI26328JzgU5NiwKGHVph4Cd6qyY4GJiamdvu3FlOzp8/P9gIYBhieJHu7h5i0BsGi3AQ/P0+ghVzoMpJktZLiPwTP7Lro2FCJ9Ec98zTNM7tdgcpLS0l48aNGzwhEt+wYQOZPWs26e7puavmodZRewrB9M5+d3Z29vIcEBDVZgIr3U0EbSJIXFwckUQdgQBoJ6DCQ0NDybr168jixYsJTVRlZWWkcFkh0wAlXba9bICEF0kEraWPmJgYjcCVK1faeZ/gV+t+POL1mpqaFuokra2tMCwiEvQ6CRSTDJIOQ81uHxLnNdXVIJsGPPyNgqHRgSTYPF2r8G/Wfr6WvcfeIRAZGVmCcxN5AmS28CBmL1mypE5LJEsL2EKj3gAupxMqKys14dVVVLiJEZSNPDqWLtW8/Pbt25AzNwfQNOwbt8sNZ86c0Uo0fr+Mhj5PAWxYEZOjoqLWoRnYURoaGsAeagOdIILdZoP93+9nG1RVVTHhVCvqCTUSry/VElXas88CujWbLywcTGKLFi36Eeey+aHF4CaEmuHl4uLiRvWkaz5ZM5DtkERkeAR88N77EBoSgsIlTfidJF579TWYnjZN8/8nHn8cLl26xPZDLXTJsvwh77Qsd/aGNsRT6EyfYoix1gZjGvLz8thG6JSaSe4UHgxGGDMIfcbGDIfa2lqtoUlPT9/Le4JI7nt3tWK0JmRj01lN7ahWsLeXLwdMJmxTetL7ETBIevbdmKQkOHz4sOY3K1asqMf5PN5z3LMrEvgL6hwLc3JyfqAlWR0VFRUw/onxIPLT0SfVCgU1kapyh80Oeai133/7TVtbUlJCK+Db3PNt9+sLRe6QYxCLs7KyvsNmxK9uREOssqISXsnNhUlPPgkjE0ZAXGwcO+3zz6XDyhUr4fjx45rD0WdRUVE9Fz6Zt/jSf3XFtB6EcFXNx/7/yz179rTc2XpTE7W0tNCmk+UN6i/B4/Tp039nZ2fv42qfyNt8PXmIqxj10jjENMTyGTNmfItl9xJqxPdv94Hu7m5q9+u5ublHFEWhNX8WIomrXf+wNyORO6aVt+rDKCGsZCPj4+OjES7MaBa9Xi8iqR68K9y4ePHiFUQTfvcHLaqIVkQHvxX5H/VyquNELNw0ofyp8HmBF5ZuxN/8PniLN51qvof/eztWNaLjTqTnTynoau7jN2KfWukeZNN/BBgAuv9KN1s0G/YAAAAASUVORK5CYII=';
	closeBtn.setAttribute('style', 'position:absolute;top:-21px;right:-21px;cursor:pointer;opacity:0.7;display:none;z-index:1000003;');
	closeBtn.addEventListener('click', visi_lightbox_remove);
	closeBtn.addEventListener('mouseover', visi_lightbox_closeBtn_mouseover);
	closeBtn.addEventListener('mouseout', visi_lightbox_closeBtn_mouseout);
	content_fixed.appendChild(closeBtn);

	document.body.appendChild(content_fixed);
	overlay_wrapper.addEventListener('click', visi_lightbox_remove);
	window.addEventListener('keypress', function (e) {
		if (e.keyCode == 27) {
			visi_lightbox_remove();
		}
	});

	_VisiLightBoxLoaded = true;
}

function visi_lightbox(config) {

	config.showCloseBtn = true;

	if((document.getElementById('visi_lightbox_overlay_wrapper') == null) && _VisiLightBoxLoaded == false && _InitVisiLightBoxCalled == false){

		_InitVisiLightBoxCalled = true;
		InitLightBox();
	}

	if(_VisiLightBoxLoaded == false || document.body == null || typeof(document.body) == typeof(undefined)){

		setTimeout(function(){visi_lightbox(config);}, 500);
		return;
	}

	if ((config && typeof config.content == 'string' && config.content) || config.source == 'mail_subscription_form') {

		if (config.style) {
			if (config.style == "none")
				document.getElementById('visi_lightbox_popbox').removeAttribute("style");
			else if (config.style == "default")
				document.getElementById('visi_lightbox_popbox').setAttribute('style', 'position: relative; border-radius: 10px; background-color:white; opacity:1; padding: 10px; -webkit-box-shadow: 0px 0px 34px 9px rgba(0,0,0,0.75); -moz-box-shadow: 0px 0px 34px 9px rgba(0,0,0,0.75); box-shadow: 0px 0px 34px 9px rgba(0,0,0,0.75); -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box;');
			else
				document.getElementById('visi_lightbox_popbox').setAttribute('style', config.style);
		}

		if (config.width)
			document.getElementById('visi_lightbox_popbox').style.width = config.width + "px";

		if (config.height)
			document.getElementById('visi_lightbox_popbox').style.height = config.height + "px";

		if (config.showCloseBtn && config.showCloseBtn == true)
			document.getElementById('img_lightbox_close').style.display = "";

		if (config.source == 'html') {
			document.getElementById('visi_lightbox_popbox').innerHTML = config.content;
		}
		else if (config.source == 'div') {
			if (document.getElementById(config.content))
				document.getElementById('visi_lightbox_popbox').innerHTML = document.getElementById(config.content).innerHTML;
			else
				document.getElementById('visi_lightbox_popbox').innerHTML = '<div style="color: red; font-weight: bold; padding: 10px 15px;">Div with id="' + config.content + '" does not exits!</div>';
		}
		else if (config.source == 'url') {
			document.getElementById('visi_lightbox_popbox').innerHTML = '<iframe frameborder="0" width="' + document.getElementById('visi_lightbox_popbox').style.width.replace("px", "") + '" height="' + document.getElementById('visi_lightbox_popbox').style.height.replace("px", "") + '" src="' + config.content + '"><p>Your browser does not support iframes.</p></iframe>';
		}
		else if (config.source == 'mail_subscription_form') {
			document.getElementById('visi_lightbox_popbox').innerHTML = '<div id="visilabs_mail_subscription_form_container'+config.actid+'" style="' + config.container_style + '">'
				+ '<div id="visilabs_mail_subscription_form_title" style="' + config.title_style + '">' + config.title + '</div>'
				+ '<div id="visilabs_mail_subscription_form_message" style="' + config.message_style + '">' + config.message + '</div>'
				+ '<input id="visilabs_mail_subscription_form_input'+config.actid+'" type="email" placeholder="' + config.placeholder + '" style="' + config.input_style + '">'
				+ '<span id="visilabs_mail_subscription_invalid-email-span" style="color:#b94a48;margin-top:5px;margin-bottom:10px;display:none;">Invalid e-mail address.</span>'
				+ '<button id="visilabs_mail_subscription_form_button'+config.actid+'" type="button" style="' + config.button_style + '">' + config.button_label + '</button>'
				+ '</div>';

			document.getElementById("visilabs_mail_subscription_form_input"+config.actid).onclick = function () {
				document.getElementById("visilabs_mail_subscription_invalid-email-span").style.display = "none";
			};

			document.getElementById("visilabs_mail_subscription_form_button"+config.actid).onclick = function () {
				var email = document.getElementById("visilabs_mail_subscription_form_input"+config.actid).value;
				if (visiValidateEmail(email)) {
					(new Visilabs()).SubscriptionWorker(config.actid, config.auth, email, false);
				} else {
					document.getElementById("visilabs_mail_subscription_invalid-email-span").style.display = "block";
				}
			};

		}
	}

	document.getElementById('visi_lightbox_overlay_wrapper').style.display = '';
	document.getElementById('visi_lightbox_overlay').style.display = '';
	document.getElementById('visi_lightbox_content_fixed').style.display = '';

	if (document.getElementById('visi_lightbox_popbox').offsetWidth > document.body.offsetWidth)
		document.getElementById('visi_lightbox_popbox').style.width = (document.body.offsetWidth - 100) + "px";

	if (document.getElementById('visi_lightbox_popbox').offsetHeight > document.documentElement.clientHeight)
		document.getElementById('visi_lightbox_popbox').style.height = (document.documentElement.clientHeight - 100) + "px";
}

function visi_lightbox_remove() {

	if(_VisiLightBoxLoaded){

		if(document.getElementById('visi_lightbox_overlay_wrapper') == null || document.body == null || typeof(document.body) == typeof(undefined)){

			setTimeout(visi_lightbox_remove, 500);
			return;
		}

		document.getElementById('visi_lightbox_overlay_wrapper').style.display = 'none';
		document.getElementById('visi_lightbox_overlay').style.display = 'none';
		document.getElementById('visi_lightbox_content_fixed').style.display = 'none';
	}
}

function visi_lightbox_closeBtn_mouseover() {
	document.getElementById('img_lightbox_close').style.opacity = "1";
}
function visi_lightbox_closeBtn_mouseout() {
	document.getElementById('img_lightbox_close').style.opacity = '0.7';
}

(function (global, undefined) {
	"use strict";

	var document = global.document, visi_notifier;

	visi_notifier = function () {

		var _notifier = {},
			$, elCover, elLog, getTransitionEvent;

		getTransitionEvent = function () {
			var t,
				type,
				supported = false,
				el = document.createElement("fakeelement"),
				transitions = {
					"WebkitTransition": "webkitTransitionEnd",
					"MozTransition": "transitionend",
					"OTransition": "otransitionend",
					"transition": "transitionend"
				};

			for (t in transitions) {
				if (el.style[t] !== undefined) {
					type = transitions[t];
					supported = true;
					break;
				}
			}

			return {
				type: type,
				supported: supported
			};
		};

		$ = function (id) {
			return document.getElementById(id);
		};

		_notifier = {

			delay: 5000,
			bgColor: 'rgba(0,0,0,0.9)',
			position: 'bottomRight',
			width: 0,
			height: 0,
			showCloseBtn: false,
			closeBtnImage: '',
			transition: undefined,

			bind: function (el, event, fn) {
				if (typeof el.addEventListener === "function") {
					el.addEventListener(event, fn, false);
				} else if (el.attachEvent) {
					el.attachEvent("on" + event, fn);
				}
			},

			close: function (elem, position, doHide) {

				var self = this, hideElement, transitionDone;

				if (this.showCloseBtn != true || doHide == true) {
					this.bind(elem, "click", function () {
						hideElement(elem);
					});
				}

				transitionDone = function (event) {
					event.stopPropagation();
					self.unbind(this, self.transition.type, transitionDone);

					if (elLog.innerHTML != "")
						elLog.removeChild(this);

					if (!elLog.hasChildNodes())
						elLog.style.display = "none";
				};
				hideElement = function (el) {
					if (typeof el !== "undefined" && el.parentNode === elLog) {
						if (self.transition.supported) {
							self.bind(el, self.transition.type, transitionDone);
							el.style.transition = "all 500ms cubic-bezier(0.600, -0.280, 0.735, 0.045)";

							if (position == "topLeft") {
								el.style.transform = "translate(-" + el.clientWidth + "px, 0px)";
							}
							else if (position == "top") {
								el.style.transform = "translate(0px, -" + el.clientHeight + "px)";
							}
							else if (position == "topRight") {
								el.style.transform = "translate(" + el.clientWidth + "px, 0px)";
							}
							else if (position == "right") {
								el.style.transform = "translate(" + el.clientWidth + "px, 0px)";
							}
							else if (position == "left") {
								el.style.transform = "translate(-" + el.clientWidth + "px, 0px)";
							}
							else if (position == "bottomLeft") {
								el.style.transform = "translate(-" + el.clientWidth + "px, 0px)";
							}
							else if (position == "bottom") {
								el.style.transform = "translate(0px, " + el.clientHeight + "px)";
							}
							else if (position == "bottomRight") {
								el.style.transform = "translate(" + el.clientWidth + "px, 0px)";
							}
						} else {
							elLog.removeChild(el);
							if (!elLog.hasChildNodes())
								elLog.style.display = "none";
						}
					}
				};

				if (this.delay == 0) return;
				setTimeout(function () { hideElement(elem); }, this.delay);
			},

			init: function () {
				//document.createElement("nav");
				//document.createElement("article");
				//document.createElement("section");

				//if ($("notifier-cover") == null) {
				//    elCover = document.createElement("div");
				//    elCover.setAttribute("id", "notifier-cover");
				//    elCover.style.position = "fixed";
				//    elCover.style.zIndex = "99999";
				//    elCover.style.top = "0";
				//    elCover.style.right = "0";
				//    elCover.style.bottom = "0";
				//    elCover.style.left = "0";
				//    elCover.style.backgroundColor = "white";
				//    elCover.style.filter = "alpha(opacity=0)";
				//    elCover.style.opacity = "0";
				//    elCover.style.display = "none";
				//    document.body.appendChild(elCover);
				//}

				if ($("VisiNotifierSection") == null) {
					elLog = document.createElement("section");
					elLog.setAttribute("id", "VisiNotifierSection");
					elLog.style.position = "fixed";
					elLog.style.zIndex = "5000";
					document.body.appendChild(elLog);
				}
				document.body.setAttribute("tabindex", "0");
				this.transition = getTransitionEvent();
			},

			log: function (message) {

				var check = function () {
					if (elLog && elLog.scrollTop !== null) return;
					else check();
				};
				this.init();
				check();

				elLog.style.display = "";
				elLog.style.position = "fixed";
				elLog.style.zIndex = "5000";

				elLog.style.top = "";
				elLog.style.left = "";
				elLog.style.right = "";
				elLog.style.bottom = "";

				if (this.position == "topLeft") {
					elLog.style.top = "10px";
					elLog.style.left = "10px";
				}
				else if (this.position == "top") {
					elLog.style.top = "0px";
					elLog.style.left = "0px";
				}
				else if (this.position == "topRight") {
					elLog.style.top = "10px";
					elLog.style.right = "10px";
				}
				else if (this.position == "right") {
					elLog.style.top = "0px";
					elLog.style.right = "0px";
				}
				else if (this.position == "left") {
					elLog.style.top = "0px";
					elLog.style.left = "0px";
				}
				else if (this.position == "bottomLeft") {
					elLog.style.bottom = "10px";
					elLog.style.left = "10px";
				}
				else if (this.position == "bottom") {
					elLog.style.bottom = "0px";
					elLog.style.left = "0px";
				}
				else if (this.position == "bottomRight") {
					elLog.style.bottom = "10px";
					elLog.style.right = "10px";
				}

				this.notify(message);
				return this;
			},

			notify: function (message) {
				var log = document.createElement("article");

				var po = this.position;

				log.style.display = "block";
				if (po != "top" && po != "bottom")
					log.style.marginTop = "10px";
				if (po == "left")
					log.style.cssFloat = "left";
				else if (po == "right")
					log.style.cssFloat = "right";
				log.style.position = "relative";
				log.style.opacity = "0";
				log.style.overflow = "auto";
				log.style.border = "1px solid rgba(255, 255, 255, 0.70)";
				log.style.boxShadow = "3px 3px 3px rgba(0,0,0,0.3)";
				log.style.fontFamily = "sans-serif";
				//log.style.background = "#1F1F1F";
				//log.style.background = "rgba(0,0,0,0.9)";
				//log.style.padding = "15px";
				log.style.borderRadius = "4px";
				log.style.color = "#FFF";
				log.style.textShadow = "-1px -1px 0 rgba(0,0,0,0.5)";

				log.style.transition = "all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275)";

				if (po == "topLeft") {
					log.style.left = "-" + this.width + "px";
				}
				else if (po == "top") {
					if (this.width == 0) {
						log.style.left = "0px";
						this.width = document.documentElement.clientWidth - 5;
					}
					else {
						log.style.left = (document.documentElement.clientWidth / 2) - (this.width / 2) + "px";
					}
				}
				else if (po == "topRight") {
					log.style.right = "-" + this.width + "px";
				}
				else if (po == "right") {
					if (this.height == 0) {
						log.style.top = "-10px";
						this.height = document.documentElement.clientHeight - 5;
					}
					else {
						log.style.top = (document.documentElement.clientHeight / 2) - (this.height / 2) + "px";
					}
				}
				else if (po == "left") {
					if (this.height == 0) {
						log.style.top = "-10px";
						this.height = document.documentElement.clientHeight - 5;
					}
					else {
						log.style.top = (document.documentElement.clientHeight / 2) - (this.height / 2) + "px";
					}
				}
				else if (po == "bottomLeft") {
					log.style.left = "-" + this.width + "px";
				}
				else if (po == "bottom") {
					if (this.width == 0) {
						log.style.left = "0px";
						this.width = document.documentElement.clientWidth - 5;
					}
					else {
						log.style.left = (document.documentElement.clientWidth / 2) - (this.width / 2) + "px";
					}
				}
				else if (po == "bottomRight") {
					log.style.right = "-" + this.width + "px";
				}

				log.style.backgroundColor = this.bgColor;

				if (this.width > 0)
				//log.style.maxWidth = this.width + "px";
					log.style.width = this.width + "px";
				if (this.height > 0)
				//log.style.maxHeight = this.height + "px";
					log.style.height = this.height + "px";

				log.innerHTML = message;

				if (this.showCloseBtn == true) {

					var closeBtn = document.createElement("img");

					closeBtn.setAttribute('style', 'position:absolute;top:1px;right:1px;cursor:pointer;opacity:0.7;');

					if (this.closeBtnImage == '') {

						closeBtn.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA/tJREFUeNqEVG1oW2UUfm9u7k1z89HU5TtiiW4Thpo4EzT+q7RiWf3XBn+0ds2fWJxzQ7aBFEbxAxWHq0OabhQrbcekUEqnFNaMgnUW29QfCitLi2hrVtKPZGvTmdwkPZ73zU0ZM9oDD/feN+c873NOzjkc+X9TIQSEWvkuIvLKs6Jx/3FehbAgDkqSdNBisVhVaPfQ0un073i+iLiL2EHAforMiGP19fUDQ0NDS6urq1lQbGtrqzA5ObkaCoW+FwShA/2eeEh9RTJXTU3NqcHBwSVKkM/n4Ub0Bly+chl6I71w/bvrcH/rPiOfnZ1Neb3eixhzRCnLv8yKdmZmZiZNA3r7euGo/wWwOKxgtpvhgM3M3p99/jno/qCbXba5uVkMBAJ9GHtIEbRnWp7nm8fHx+9SsrffPQFE4EBj0ILFaQXb4/YSXHbQmfSAofDasUbY3t6G5eXlHAo5hxyPPUz4VHNz8ygl+6LnIi0ytLwRhA8//gi0Rgn0NQaoNptApeHheKgDznefB8ITaA+1s/R7enp+xZiXyippUV+fmppKYgpgddqYgktfXYLyBRyqpZcE8ZJisQjzv8yDwWQElaiCWz/dgnQqnTcajSfRR6KEOrvdfpbW5Nq311igRhJBZ5Bg+OowI/30s0+gJdgChXwBYvMxcLocIIhq5vvOyRPMp66u7gptNapOcDqdNrVaTeJ37rD8eY4nclYmoY4Okstmydkz5wjGkB+npwkSk7W1NSJJWpKXCyQeX2QxtbW1tG+raM6cmrKhoYJSRXfxFl4guZxMotGbpQngOHJ74TZJJteIKIgEdkuueVkuieD5Ehc9S6VSaXrodLlKXpjMg+zfJNgSJF8PDJDpH6ZJIvEXCYffQsUyOX361N58WC1W9kwmk/fwkaPvIlrr4tJSJh6PQ5WoARWngjfb2tgfMDc3B+YDZjzjYHi4VNO+SB9oq7SshpFIBGRZ3nU4HO/jt748z96urq4Z6ny8vZ05Xvj8Ap0GsNtswBEOBLUAGlGEkZERiEajoNFo4OlDhyGTycDY2NifGNNAMy/3oQkXwHsrKyu59fV18Ho8jNRUXQ1qFQ86VCMhRCTVSzoQeDUY9Aa4icS0OzweDx1Bx6NzfBj/+m9QPiQSCXi1oQGUTYIKCagIt/f9pNsNExMTLP1wODyJZ/5K8ywijjY2Nl7d2NgoUOfR0VFoa22FlwMB8Pt80NTUxEqBW4fVt7Ozk5K9Um7oSqah28Ptdnf39/cv7OzsFOERKxQKtGZ/+Hy+LxVl0n4LllcG/QgO/Yt+v/8Z2rTYZxyWIh2LxRZwIfyMv/+GWFc2+L4bu0ysVVpBq5zRPssgHtA5qBT0jwADAKOeG2u13ga9AAAAAElFTkSuQmCC';
					}
					else {

						closeBtn.src = this.closeBtnImage;
					}

					var noti = this;

					closeBtn.addEventListener('mouseover', function () { this.style.opacity = "1"; });
					closeBtn.addEventListener('mouseout', function () { this.style.opacity = '0.7'; });
					closeBtn.addEventListener('click', function () { noti.close(log, po, true); });

					log.appendChild(closeBtn);
				}

				elLog.appendChild(log);

				setTimeout(function () {
					log.style.opacity = "1";

					if (po == "topLeft") {
						log.style.left = "0";
					}
					else if (po == "top") {
						log.style.top = "0";
						log.style.left = "0";
					}
					else if (po == "topRight") {
						log.style.right = "0";
					}
					else if (po == "right") {
						log.style.right = "0";
					}
					else if (po == "left") {
						log.style.left = "0";
					}
					else if (po == "bottomLeft") {
						log.style.left = "0";
					}
					else if (po == "bottom") {
						log.style.bottom = "0";
						log.style.left = "0";
					}
					else if (po == "bottomRight") {
						log.style.right = "0";
					}

				}, 50);

				this.close(log, this.position, false);
			},

			set: function (args) {
				var k;
				if (typeof args !== "object" && args instanceof Array) {
					//args must be an object
				}
				else {
					for (k in args) {
						if (args.hasOwnProperty(k)) {
							this[k] = args[k];
						}
					}
				}
			},

			unbind: function (el, event, fn) {
				if (typeof el.removeEventListener === "function") {
					el.removeEventListener(event, fn, false);
				} else if (el.detachEvent) {
					el.detachEvent("on" + event, fn);
				}
			}
		};

		return {
			init: _notifier.init,
			log: function (message) { _notifier.log(message); return this; },
			set: function (args) { _notifier.set(args); },
		};
	};

	if (typeof global.visi_notifier === "undefined") {
		global.visi_notifier = new visi_notifier();
	}

}(this));

function ResetVisiNotifier() {
	visi_notifier.set({
		delay: 5000,
		bgColor: 'rgba(0,0,0,0.9)',
		position: 'bottomRight',
		width: 0,
		height: 0,
		showCloseBtn: false,
		closeBtnImage: ''
	});
}

function VL_SwapWidget(ID, Pos){

	if (document.getElementById(ID).getAttribute("status") == "false") {

		document.getElementById(ID).querySelector(".verticalProductRecommend").style.display = 'block';
		document.getElementById(ID).setAttribute("status", "true");

		Pos == "left" ? document.getElementById(ID).querySelector(".showhideSign").innerHTML = "&#10094;" : document.getElementById(ID).querySelector(".showhideSign").innerHTML = "&#10095;";
	}
	else {

		document.getElementById(ID).querySelector(".verticalProductRecommend").style.display = 'none';
		document.getElementById(ID).setAttribute("status", "false");
		Pos == "left" ? document.getElementById(ID).querySelector(".showhideSign").innerHTML = "&#10095;" : document.getElementById(ID).querySelector(".showhideSign").innerHTML = "&#10094;";
	}
}

function VL_ScrollWidgetToUp(ID, Amount) {

	if (document.getElementById(ID).scrollTop <= 0)
		return;

	document.getElementById(ID).scrollTop -= Amount;

	document.getElementById(ID).scrollTop <= 0 ? document.getElementById(ID).previousElementSibling.style.opacity = .5 : document.getElementById(ID).previousElementSibling.style.opacity = 1;
	document.getElementById(ID).nextElementSibling.style.opacity = 1;
}

function VL_ScrollWidgetToDown(ID, Amount) {

	var liHeight = parseInt(document.getElementById(ID).firstElementChild.style.height.replace("px", ""));
	var liCount = document.getElementById(ID).childElementCount;

	if (document.getElementById(ID).scrollTop + Amount >= liHeight * liCount)
		return;

	document.getElementById(ID).scrollTop += Amount;

	document.getElementById(ID).scrollTop + Amount >= liHeight * liCount ? document.getElementById(ID).nextElementSibling.style.opacity = .5 : document.getElementById(ID).nextElementSibling.style.opacity = 1;
	document.getElementById(ID).previousElementSibling.style.opacity = 1;
}

function ToggleVisiNotifierStyle2(actID, Sender) {

	var status = document.getElementById('VisiNotifierStyle2').getAttribute("status");

	if (window.jQuery) {
		if (status == "Minimized") {
			jQuery("#VisiNotifierStyle2").find(".contentMinimized").fadeOut(function () { jQuery("#VisiNotifierStyle2").find(".contentMaximized").fadeIn(); })
		}
		else {
			jQuery("#VisiNotifierStyle2").find(".contentMaximized").fadeOut(function () { jQuery("#VisiNotifierStyle2").find(".contentMinimized").fadeIn(); })
		}
	}
	else {
		if (status == "Minimized") {
			document.getElementById('VisiNotifierStyle2').querySelector(".contentMinimized").style.display = 'none';
			document.getElementById('VisiNotifierStyle2').querySelector(".contentMaximized").style.display = 'block';
		}
		else {
			document.getElementById('VisiNotifierStyle2').querySelector(".contentMaximized").style.display = 'none';
			document.getElementById('VisiNotifierStyle2').querySelector(".contentMinimized").style.display = 'block';
		}
	}

	if (status == "Minimized") {
		document.getElementById('VisiNotifierStyle2').setAttribute('status', '');
	}
	else {
		document.getElementById('VisiNotifierStyle2').setAttribute('status', 'Minimized');
		Sender.SetCookie("VisiNotifierStyle2_" + actID + "_status", "Minimized", 1, "D");
	}
}

function LoadVisiNotifierStyle2(actID, cMax, cMin, Sender, showCloseBtn, closeBtnImage, position, delay) {

	//if (window.innerWidth < 1200)
	//return;

	var cookieVal = Sender.GetCookie("VisiNotifierStyle2_" + actID + "_status");

	var visiNotifierStyle2 = document.createElement('section');
	visiNotifierStyle2.id = 'VisiNotifierStyle2';
	visiNotifierStyle2.setAttribute('style', "display: block; position: fixed; z-index: 9999; ");

	if (position == "topLeft") {
		visiNotifierStyle2.style.top = "0px";
		visiNotifierStyle2.style.left = "0px";
	}
	else if (position == "top") {
		visiNotifierStyle2.style.top = "0px";
		visiNotifierStyle2.style.left = "50%";
		visiNotifierStyle2.style.transform = "translate(-50%, 0)";
	}
	else if (position == "topRight") {
		visiNotifierStyle2.style.top = "0px";
		visiNotifierStyle2.style.right = "0px";
	}
	else if (position == "right") {
		visiNotifierStyle2.style.top = "50%";
		visiNotifierStyle2.style.right = "0px";
		visiNotifierStyle2.style.transform = "translate(0, -50%)";
	}
	else if (position == "left") {
		visiNotifierStyle2.style.top = "50%";
		visiNotifierStyle2.style.left = "0px";
		visiNotifierStyle2.style.transform = "translate(0, -50%)";
	}
	else if (position == "bottomLeft") {
		visiNotifierStyle2.style.bottom = "0px";
		visiNotifierStyle2.style.left = "0px";
	}
	else if (position == "bottom") {
		visiNotifierStyle2.style.bottom = "0px";
		visiNotifierStyle2.style.left = "50%";
		visiNotifierStyle2.style.transform = "translate(-50%, 0)";
	}
	else if (position == "bottomRight") {
		visiNotifierStyle2.style.bottom = "0px";
		visiNotifierStyle2.style.right = "0px";
	}
	else /*if (position == "bottomRight")*/ {
		visiNotifierStyle2.style.bottom = "0px";
		visiNotifierStyle2.style.right = "0px";
	}

	var contentMaximized = document.createElement('div');
	contentMaximized.className = "contentMaximized";
	contentMaximized.innerHTML = cMax;

	if (showCloseBtn == true) {

		contentMaximized.style.position = 'relative';

		var closeBtn = document.createElement("img");

		closeBtn.setAttribute('style', 'position:absolute;top:2px;right:2px;cursor:pointer;opacity:0.7;');

		if (closeBtnImage == '') {
			closeBtn.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA/tJREFUeNqEVG1oW2UUfm9u7k1z89HU5TtiiW4Thpo4EzT+q7RiWf3XBn+0ds2fWJxzQ7aBFEbxAxWHq0OabhQrbcekUEqnFNaMgnUW29QfCitLi2hrVtKPZGvTmdwkPZ73zU0ZM9oDD/feN+c873NOzjkc+X9TIQSEWvkuIvLKs6Jx/3FehbAgDkqSdNBisVhVaPfQ0un073i+iLiL2EHAforMiGP19fUDQ0NDS6urq1lQbGtrqzA5ObkaCoW+FwShA/2eeEh9RTJXTU3NqcHBwSVKkM/n4Ub0Bly+chl6I71w/bvrcH/rPiOfnZ1Neb3eixhzRCnLv8yKdmZmZiZNA3r7euGo/wWwOKxgtpvhgM3M3p99/jno/qCbXba5uVkMBAJ9GHtIEbRnWp7nm8fHx+9SsrffPQFE4EBj0ILFaQXb4/YSXHbQmfSAofDasUbY3t6G5eXlHAo5hxyPPUz4VHNz8ygl+6LnIi0ytLwRhA8//gi0Rgn0NQaoNptApeHheKgDznefB8ITaA+1s/R7enp+xZiXyippUV+fmppKYgpgddqYgktfXYLyBRyqpZcE8ZJisQjzv8yDwWQElaiCWz/dgnQqnTcajSfRR6KEOrvdfpbW5Nq311igRhJBZ5Bg+OowI/30s0+gJdgChXwBYvMxcLocIIhq5vvOyRPMp66u7gptNapOcDqdNrVaTeJ37rD8eY4nclYmoY4Okstmydkz5wjGkB+npwkSk7W1NSJJWpKXCyQeX2QxtbW1tG+raM6cmrKhoYJSRXfxFl4guZxMotGbpQngOHJ74TZJJteIKIgEdkuueVkuieD5Ehc9S6VSaXrodLlKXpjMg+zfJNgSJF8PDJDpH6ZJIvEXCYffQsUyOX361N58WC1W9kwmk/fwkaPvIlrr4tJSJh6PQ5WoARWngjfb2tgfMDc3B+YDZjzjYHi4VNO+SB9oq7SshpFIBGRZ3nU4HO/jt748z96urq4Z6ny8vZ05Xvj8Ap0GsNtswBEOBLUAGlGEkZERiEajoNFo4OlDhyGTycDY2NifGNNAMy/3oQkXwHsrKyu59fV18Ho8jNRUXQ1qFQ86VCMhRCTVSzoQeDUY9Aa4icS0OzweDx1Bx6NzfBj/+m9QPiQSCXi1oQGUTYIKCagIt/f9pNsNExMTLP1wODyJZ/5K8ywijjY2Nl7d2NgoUOfR0VFoa22FlwMB8Pt80NTUxEqBW4fVt7Ozk5K9Um7oSqah28Ptdnf39/cv7OzsFOERKxQKtGZ/+Hy+LxVl0n4LllcG/QgO/Yt+v/8Z2rTYZxyWIh2LxRZwIfyMv/+GWFc2+L4bu0ysVVpBq5zRPssgHtA5qBT0jwADAKOeG2u13ga9AAAAAElFTkSuQmCC';
		}
		else {
			closeBtn.src = closeBtnImage;
		}

		closeBtn.addEventListener('mouseover', function () { this.style.opacity = "1"; });
		closeBtn.addEventListener('mouseout', function () { this.style.opacity = '0.7'; });
		closeBtn.addEventListener('click', function () { document.body.removeChild(visiNotifierStyle2); });

		contentMaximized.appendChild(closeBtn);
	}

	var contentMinimized = document.createElement('div');
	contentMinimized.className = "contentMinimized";
	contentMinimized.style.cursor = "pointer";
	contentMinimized.innerHTML = cMin;
	contentMinimized.addEventListener('click', function () { ToggleVisiNotifierStyle2(actID, Sender); });

	if (cookieVal == "Minimized") {
		visiNotifierStyle2.setAttribute('status', 'Minimized');
		contentMaximized.style.display = 'none';
		contentMinimized.style.display = 'block';
	}
	else {
		contentMaximized.style.display = 'block';
		contentMinimized.style.display = 'none';
	}

	visiNotifierStyle2.appendChild(contentMaximized);
	visiNotifierStyle2.appendChild(contentMinimized);

	document.body.appendChild(visiNotifierStyle2);

	if (document.getElementById('btnMinimizeVisiNotifier')) {
		document.getElementById('btnMinimizeVisiNotifier').onclick = function () {
			ToggleVisiNotifierStyle2(actID, Sender);
		};
	}

	if (delay == 0 || cookieVal == "Minimized") {
		return;
	}

	setTimeout(function () { ToggleVisiNotifierStyle2(actID, Sender); }, delay);
}

function VL_ScrollLeft(ID, Amount){

	document.getElementById(ID).scrollLeft = document.getElementById(ID).scrollLeft + Amount;
}

function VL_ScrollRight(ID, Amount){

	document.getElementById(ID).scrollLeft = document.getElementById(ID).scrollLeft - Amount;
}

var	ScrollerQueue		= new Array();
var	IsScrollerRunning	= false;

function VL_ScrollerQueueItem(Item, Direction, ScrollAmount){

	this.Item			= Item
	this.ScrollAmount	= ScrollAmount;
	this.Amount			= 0;
	this.Step			= 10;
	this.MaxStep		= 10;
	this.Finished		= false;
	this.Direction		= Direction;

	ScrollerQueue[ScrollerQueue.length]	= this;
}

function VL_ScrollElement(Item, Direction, ScrollAmount){

	VL_ScrollerQueueItem(document.getElementById(Item), Direction, ScrollAmount);

	if(!IsScrollerRunning)
		VL_StartScroller();
}

function VL_StartScroller(){

	if(ScrollerQueue.length > 0){

		IsScrollerRunning	= true;

		if(ScrollerQueue[0].Amount < ScrollerQueue[0].ScrollAmount){

			if(ScrollerQueue[0].Amount + ScrollerQueue[0].Step > ScrollerQueue[0].ScrollAmount){

				ScrollerQueue[0].Step	= ScrollerQueue[0].ScrollAmount - ScrollerQueue[0].Amount;
			}
			else{

				ScrollerQueue[0].Amount	+= ScrollerQueue[0].Step;
			}

			switch(ScrollerQueue[0].Direction)
			{
				case "N":
				{
					ScrollerQueue[0].Item.scrollTop		+= ScrollerQueue[0].Step;
					break;
				}
				case "S":
				{
					ScrollerQueue[0].Item.scrollTop		-= ScrollerQueue[0].Step;
					break;
				}
				case "E":
				{
					ScrollerQueue[0].Item.scrollLeft	-= ScrollerQueue[0].Step;
					break;
				}
				case "W":
				{
					ScrollerQueue[0].Item.scrollLeft	+= ScrollerQueue[0].Step;
					break;
				}
			}
		}
		else{

			ScrollerQueue.splice(0, 1);
		}

		setTimeout(VL_StartScroller, 1);
	}
	else{

		IsScrollerRunning	= false;
	}
}

function LoadVisiCountDown(actID, cMax, cMin, Sender, position, gradientColor1, gradientColor2, countDownDate) {

	var distance = countDownDate - new Date().getTime();

	if (distance < 0)
		return;

	var elVisiCountDown = document.getElementsByClassName("VisiCountDown");
	while (elVisiCountDown.length > 0) {
		window.clearInterval(elVisiCountDown[0].getAttribute("intervalid"))
		elVisiCountDown[0].parentNode.removeChild(elVisiCountDown[0]);
	}

	if (gradientColor1 == "")
		gradientColor1 = "transparent";

	if (gradientColor2 == "")
		gradientColor2 = "transparent";

	var elID = "VisiCountDown" + actID;

	var cookieVal = Sender.GetCookie("VisiCountDown_" + actID + "_status");
	///TEST
	//cookieVal = "Minimized";

	var daysString = "";
	var hoursString = "";
	var minutesString = "";
	var secondsString = "";
	var showSeconds = cMax.indexOf("VisiCountDownTimer_Seconds") > -1;
	var interval = 1000;

	// if (!showSeconds)
	// interval = 60000;

	switch (position) {
		case "top":
		case "bottom":
		{
			var visiCountDown = document.createElement("section");
			visiCountDown.id = elID;
			visiCountDown.className = "VisiCountDown";
			//visiCountDown.setAttribute("style", "width: 100%; position: fixed; background: " + gradientColor2 + "; background: -webkit-linear-gradient(" + gradientColor1 + ", " + gradientColor2 + "); background: -o-linear-gradient(" + gradientColor1 + ", " + gradientColor2 + "); background: -moz-linear-gradient(" + gradientColor1 + ", " + gradientColor2 + "); background: linear-gradient(" + gradientColor1 + ", " + gradientColor2 + ");");
			visiCountDown.style.width = "100%";
			visiCountDown.style.position = "fixed";
			visiCountDown.style.background = gradientColor2;
			if (gradientColor1 != gradientColor2) {
				visiCountDown.style.background = "linear-gradient(" + gradientColor1 + ", " + gradientColor2 + ")";
			}

			if (position == "top") {
				visiCountDown.style.top = "0px";
			}
			else {
				visiCountDown.style.bottom = "0px";
			}


			var contentMaximized = document.createElement("div");
			contentMaximized.className = "contentMaximized";
			contentMaximized.style.position = "relative";
			contentMaximized.style.minHeight = "34px";
			contentMaximized.innerHTML = cMax;

			var contentMinimized = document.createElement("div");
			contentMinimized.className = "contentMinimized";
			contentMinimized.style.position = "relative";
			contentMinimized.style.minHeight = "5px";
			contentMinimized.innerHTML = cMin;


			if (cookieVal == "Minimized") {
				visiCountDown.setAttribute("status", "Minimized");
				contentMaximized.style.display = "none";
				contentMinimized.style.display = "block";
			}
			else {
				contentMaximized.style.display = "block"
				contentMinimized.style.display = "none";
			}


			visiCountDown.appendChild(contentMaximized);
			visiCountDown.appendChild(contentMinimized);

			document.body.appendChild(visiCountDown);

			var btnMin = document.getElementById(elID).querySelector(".btnMinimizeVisiCountDown");
			var btnMax = document.getElementById(elID).querySelector(".btnMaximizeVisiCountDown");

			if (btnMin) {

				if (btnMin.innerHTML == "") {
					if (position == "top") {
						btnMin.innerHTML = "&#9650;";
					}
					else {
						btnMin.innerHTML = "&#9660;";
					}
				}
				btnMin.style.position = "absolute";
				btnMin.style.right = "10px";
				btnMin.style.borderRadius = "7px";
				btnMin.style.padding = "0px";
				btnMin.style.width = "26px";
				btnMin.style.height = "26px";
				btnMin.style.fontSize = "16px";
				btnMin.style.background = "none";
				btnMin.style.color = "white";
				btnMin.style.cursor = "pointer";
				btnMin.onclick = function () { ToggleVisiCountDown(actID, Sender); };
			}

			if (btnMax) {

				if (btnMax.innerHTML == "") {
					btnMax.innerHTML = "&#9684;";
				}
				btnMax.style.position = "absolute";
				btnMax.style.right = "10px";
				if (position == "top") {
					btnMax.style.top = "-2px";
				}
				else {
					btnMax.style.top = "-26px";
				}
				btnMax.style.border = "none";
				btnMax.style.borderRadius = "10px";
				btnMax.style.padding = "0px";
				btnMax.style.width = "32px";
				btnMax.style.height = "32px";
				btnMax.style.fontSize = "22px";
				btnMax.style.background = "linear-gradient(" + gradientColor1 + ", " + gradientColor2 + ")";
				btnMax.style.color = "white";
				btnMax.style.cursor = "pointer";
				btnMax.onclick = function () { ToggleVisiCountDown(actID, Sender); };
			}
			else {
				contentMinimized.style.cursor = "pointer";
				contentMinimized.addEventListener("click", function () { ToggleVisiCountDown(actID, Sender); });
			}

			break;
		}
		case "topLeft":
		case "topRight":
		case "bottomLeft":
		case "bottomRight":
		{
			var visiCountDown = document.createElement("section");
			visiCountDown.id = elID;
			visiCountDown.className = "VisiCountDown";
			visiCountDown.style.position = "fixed";
			//visiCountDown.style.border = "solid 1px #b4b4b4";
			visiCountDown.style.boxShadow = "2px 2px 1px #a4a4a4";

			if (position == "topLeft") {
				visiCountDown.style.top = "5px";
				visiCountDown.style.left = "0px";
				visiCountDown.style.borderBottomRightRadius = "10px";
				visiCountDown.style.borderTopRightRadius = "20px";
				visiCountDown.style.borderLeft = "none";
			}
			else if (position == "topRight") {
				visiCountDown.style.top = "5px";
				visiCountDown.style.right = "0px";
				visiCountDown.style.borderBottomLeftRadius = "10px";
				visiCountDown.style.borderTopLeftRadius = "20px";
				visiCountDown.style.borderRight = "none";
			}
			else if (position == "bottomLeft") {
				visiCountDown.style.bottom = "16px";
				visiCountDown.style.left = "0px";
				visiCountDown.style.borderTopRightRadius = "10px";
				visiCountDown.style.borderBottomRightRadius = "20px";
				visiCountDown.style.borderLeft = "none";
			}
			else if (position == "bottomRight") {
				visiCountDown.style.bottom = "16px";
				visiCountDown.style.right = "0px";
				visiCountDown.style.borderTopLeftRadius = "10px";
				visiCountDown.style.borderBottomLeftRadius = "20px";
				visiCountDown.style.borderRight = "none";
			}

			visiCountDown.style.background = gradientColor2;
			if (gradientColor1 != gradientColor2) {
				visiCountDown.style.background = "linear-gradient(" + gradientColor1 + ", " + gradientColor2 + ")";
			}


			var contentMaximized = document.createElement("div");
			contentMaximized.className = "contentMaximized";
			contentMaximized.style.position = "relative";
			contentMaximized.innerHTML = cMax;

			var contentMinimized = document.createElement("div");
			contentMinimized.className = "contentMinimized";
			contentMinimized.style.position = "relative";
			contentMinimized.style.cursor = "pointer";
			contentMinimized.innerHTML = cMin;
			contentMinimized.addEventListener("click", function () { ToggleVisiCountDown(actID, Sender); });


			if (cookieVal == "Minimized") {
				visiCountDown.setAttribute("status", "Minimized");
				contentMaximized.style.display = "none";
				contentMinimized.style.display = "block";
			}
			else {
				contentMaximized.style.display = "block"
				contentMinimized.style.display = "none";
			}


			visiCountDown.appendChild(contentMaximized);
			visiCountDown.appendChild(contentMinimized);

			document.body.appendChild(visiCountDown);

			var btnMin = document.getElementById(elID).querySelector(".btnMinimizeVisiCountDown");

			if (btnMin) {

				if (btnMin.innerHTML == "") {

					btnMin.innerHTML = "&#8861;";
					btnMin.style.fontSize = "18px";
					//if (position == "topLeft" || position == "bottomLeft") {
					//    btnMin.innerHTML = "&#9668;";
					//}
					//else {
					//    btnMin.innerHTML = "&#9658;";
					//}
				}
				else {
					btnMin.style.fontSize = "14px";
				}

				btnMin.style.position = "absolute";

				if (position == "topLeft") {
					btnMin.style.bottom = "-10px";
					btnMin.style.right = "-10px";
					btnMin.style.background = gradientColor2;
				}
				else if (position == "topRight") {
					btnMin.style.bottom = "-10px";
					btnMin.style.left = "-10px";
					btnMin.style.background = gradientColor2;
				}
				else if (position == "bottomLeft") {
					btnMin.style.top = "-10px";
					btnMin.style.right = "-10px";
					btnMin.style.background = gradientColor1;
				}
				else if (position == "bottomRight") {
					btnMin.style.top = "-10px";
					btnMin.style.left = "-10px";
					btnMin.style.background = gradientColor1;
				}
				btnMin.style.border = "none";
				btnMin.style.width = "22px";
				btnMin.style.height = "22px";
				btnMin.style.color = "white";
				btnMin.style.borderRadius = "11px";
				btnMin.style.padding = "1px";
				btnMin.style.cursor = "pointer";
				btnMin.style.textShadow = "2px 2px 1px #333";

				btnMin.onclick = function () { ToggleVisiCountDown(actID, Sender); };
			}

			break;
		}
		default:
			break;
	}

	VisiCountDownWriteTimeLeft(elID, showSeconds, distance);

	var visiCountDownIntervalID = setInterval(function () {

		var distanceInterval = countDownDate - new Date().getTime();

		if (distanceInterval < 0) {
			clearInterval(visiCountDownIntervalID);
			//"EXPIRED";
			document.body.removeChild(document.getElementById(elID));
		}
		else {
			VisiCountDownWriteTimeLeft(elID, showSeconds, distanceInterval);
		}
	}, interval);

	document.getElementById(elID).setAttribute("intervalid", visiCountDownIntervalID);
	document.getElementById(elID).style.zIndex  = "1000000";
}

function VisiCountDownWriteTimeLeft(elID, showSeconds, distance) {

	if (document.getElementById(elID)) {

		daysString = ("0" + Math.floor(distance / (1000 * 60 * 60 * 24))).slice(-2);
		hoursString = ("0" + Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))).slice(-2);
		minutesString = ("0" + Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))).slice(-2);
		secondsString = ("0" + Math.floor((distance % (1000 * 60)) / 1000)).slice(-2);

		if (document.getElementById(elID).querySelector(".VisiCountDownTimer_Days")) {
			var tmpArr = document.getElementById(elID).querySelectorAll(".VisiCountDownTimer_Days");
			for (var i = 0; i < tmpArr.length; i++) {
				tmpArr[i].innerText = daysString;
			}
		}
		if (document.getElementById(elID).querySelector(".VisiCountDownTimer_Hours")) {
			var tmpArr = document.getElementById(elID).querySelectorAll(".VisiCountDownTimer_Hours");
			for (var i = 0; i < tmpArr.length; i++) {
				tmpArr[i].innerText = hoursString;
			}
		}
		if (document.getElementById(elID).querySelector(".VisiCountDownTimer_Minutes")) {
			var tmpArr = document.getElementById(elID).querySelectorAll(".VisiCountDownTimer_Minutes");
			for (var i = 0; i < tmpArr.length; i++) {
				tmpArr[i].innerText = minutesString;
			}
		}
		if (showSeconds && document.getElementById(elID).querySelector(".VisiCountDownTimer_Seconds")) {
			var tmpArr = document.getElementById(elID).querySelectorAll(".VisiCountDownTimer_Seconds");
			for (var i = 0; i < tmpArr.length; i++) {
				tmpArr[i].innerText = secondsString;
			}
		}

		if (document.getElementById(elID).querySelector(".btnMaximizeVisiCountDown")) {
			document.getElementById(elID).querySelector(".btnMaximizeVisiCountDown").title = daysString + " gün, " + hoursString + ":" + minutesString + (showSeconds == true ? ":" + secondsString : "");
		}
	}
}

function ToggleVisiCountDown(actID, Sender) {

	var elID = "VisiCountDown" + actID;
	var status = document.getElementById(elID).getAttribute("status");

	if (window.jQuery) {
		if (status == "Minimized") {
			$("#" + elID).find(".contentMinimized").fadeOut(function () { $("#" + elID).find(".contentMaximized").fadeIn(); })
		}
		else {
			$("#" + elID).find(".contentMaximized").fadeOut(function () { $("#" + elID).find(".contentMinimized").fadeIn(); })
		}
	}
	else {
		if (status == "Minimized") {
			document.getElementById(elID).querySelector(".contentMinimized").style.display = 'none';
			document.getElementById(elID).querySelector(".contentMaximized").style.display = 'block';
		}
		else {
			document.getElementById(elID).querySelector(".contentMaximized").style.display = 'none';
			document.getElementById(elID).querySelector(".contentMinimized").style.display = 'block';
		}
	}

	if (status == "Minimized") {
		document.getElementById(elID).setAttribute('status', '');
	}
	else {
		document.getElementById(elID).setAttribute('status', 'Minimized');
		Sender.SetCookie("VisiCountDown_" + actID + "_status", "Minimized", 1, "D");
	}
}

function EvalString(Data){

	return eval(Data);
}

function visiValidateEmail(email) {
	var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
	return re.test(email);
}